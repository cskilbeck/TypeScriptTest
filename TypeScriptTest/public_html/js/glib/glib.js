window.glib={};(function(){"use strict";function e(){var e=navigator.userAgent,t,n=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(n[1])){t=/\brv[ :]+(\d+)/g.exec(e)||[];return"MSIE "+(t[1]||"")}if(n[1]==="Chrome"){t=e.match(/\bOPR\/(\d+)/);if(t!==null){return"Opera "+t[1]}}n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"];t=e.match(/version\/(\d+)/i);if(t!==null){n.splice(1,1,t[1])}return n.join(" ")}var t=e().split(" ");glib.Browser={type:t[0],version:parseInt(t[1],10)}})();(function(){"use strict";function e(e,t,n){var r,i,s;r=Object.getOwnPropertyNames(t);for(i=0;i<r.length;++i){if(r[i].indexOf("$")===-1&&(!(r[i]in e)||n)){s=Object.getOwnPropertyDescriptor(t,r[i]);if(s.value instanceof glib.PropertyDescriptor){Object.defineProperty(e,r[i],s.value.desc)}else{Object.defineProperty(e,r[i],s)}}}}glib.PropertyDescriptor=function(e){this.desc=e};glib.Property=function(e){return new glib.PropertyDescriptor(e)};glib.Class=function(t){var n={},r;if(t.$!==undefined){n=t.$}if(t.static$!==undefined){e(n,t.static$,true)}e(n.prototype,t,true);if(t.hasOwnProperty("inherit$")){if(Object.prototype.toString.call(t.inherit$)!=="[object Array]"){e(n,t.inherit$,false);e(n.prototype,t.inherit$.prototype,false)}else{for(r=0;r<t.inherit$.length;++r){if(!t.inherit$[r]){throw new TypeError("Inheriting from undefined class!?")}else{e(n,t.inherit$[r],false);e(n.prototype,t.inherit$[r].prototype,false)}}}}return n}})();(function(){"use strict";glib.User={id:0,name:"",picture:null,providerName:""}})();(function(){"use strict";glib.OAuth=glib.Class({static$:{login:function(e,t){var n,r,i,s;n=glib.Cookies.get("session_id");r=glib.Cookies.get("provider_id")||0;s=glib.Cookies.get("login_error");if(n===null){glib.WebService.post("anon",{},{},function(n){if(n&&!n.error){glib.Cookies.set("session_id",n.session_id);glib.Cookies.set("anon_user_id",n.user_id);glib.User.id=n.user_id;e.call(t)}else{console.log("Error getting anon user id")}})}else{e.call(t)}}}})})();(function(){"use strict";(function(){var e=0,t=["moz","ms","o","webkit"],n,r=null,i=null;for(n=0;n<t.length&&!window.requestAnimationFrame;++n){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(e){clearTimeout(e)}}})();performance=window.performance||{};if(!Date.now){Date.now=function(){return(new Date).getTime()}}if(!performance.now){performance.now=performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||Date.now}if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}(function(){function n(e,t){return this.slice(e,t)}function r(e,t){var n,r,i=t||0;for(n=0,r=e.length;n<r;++n,++t){this[i]=e[n]&255}}function i(e){var t,i;if(typeof e==="number"){t=[];t.length=e;for(i=0;i<e;++i){t[i]=0}}else{t=e.slice(0)}t.subarray=n;t.buffer=t;t.byteLength=t.length;t.set=r;if(typeof e==="object"&&e.buffer){t.buffer=e.buffer}return t}try{var e=new Uint8Array(1);return}catch(t){}window.Uint8Array=i;window.Uint32Array=i;window.Int32Array=i})()})();(function(){"use strict";var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";glib.Util={shallowCopy:function(e,t){var n;for(n in e){t[n]=e[n]}},clone:function(e){var t,n;if(e===null||typeof e!="object"){return e}t=e.constructor();for(n in e){t[n]=glib.Util.clone(e[n])}return t},remove:function(e,t){var n=e.indexOf(t);if(n!==-1){e.splice(n,1)}},ease:function(e){var t=e*e,n=t*e;return 3*t-2*n},ease2:function(e,t){var n=1-e,r=Math.pow(n,t),i=Math.pow(n,t+1);return 1-(3*r-2*i)},lerp:function(e,t,n){var r=t.x-e.x,i=t.y-e.y,s=glib.Util.ease(n);return{x:e.x+r*s,y:e.y+i*s}},constrain:function(e,t,n){if(e<t){e=t}if(e>n){e=n}return e},lineDistance:function(e,t,n){var r=t.x-e.x,i=t.y-e.y,s=Math.sqrt(r*r+i*i);return(r*(n.y-e.y)-i*(n.x-e.x))/s},pointInConvexPoly:function(e,t){var n,r,i=e.length;for(n=0;n<i;++n){r=glib.Util.lineDistance(e[n],e[(n+1)%i],t);if(r<0){return false}}return true},getResponseAsArray:function(e){function t(e){if(e!==null){return new Uint8Array(e)}else{return null}}if(e.response!==undefined){return t(e.response)}if(e.mozResponseArrayBuffer!==undefined){return t(e.mozResponseArrayBuffer)}if(e.mozResponse!==undefined){return t(e.mozResponse)}if(e.responseArrayBuffer!==undefined){return t(e.responseArrayBuffer)}if(e.responseBody!==null){return t((new VBArray(e.responseBody)).toArray())}return null},circle:function(e,t,n,r){e.beginPath();e.arc(t,n,r,0,2*Math.PI,false);e.closePath()},rect:function(e,t,n,r,i){var s=t+r,o=n+i;e.beginPath();e.moveTo(t,n);e.lineTo(s,n);e.lineTo(s,o);e.lineTo(t,o);e.closePath()},roundRect:function(e,t,n,r,i,s){var o=Math.min(s,Math.min(r/2,i/2)),u=t+r,a=n+i;o=o||0;e.beginPath();e.moveTo(t+o,n);e.lineTo(u-o,n);if(o){e.quadraticCurveTo(u,n,u,n+o)}e.lineTo(u,a-o);if(o){e.quadraticCurveTo(u,a,u-o,a)}e.lineTo(t+o,a);if(o){e.quadraticCurveTo(t,a,t,a-o)}e.lineTo(t,n+o);if(o){e.quadraticCurveTo(t,n,t+o,n)}e.closePath()},getQuery:function(){return glib.Util.queryStringToObject(window.location.search.slice(1))},queryStringToObject:function(e){var t={},n,r,i;if(e){n=e.split("&");for(r in n){i=n[r];if(i.indexOf("=")!==-1){i=i.split("=");if(!!i[0]){t[i[0].toLowerCase()]=decodeURIComponent(i[1]||"")}else{t[i.toLowerCase()]=true}}}}return t},objectToQueryString:function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))}return t.join("&")},format:function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,n){return typeof t[n]!=="undefined"?t[n]:e})},pad:function(e,t){var n=Math.abs(e),r=Math.max(0,t-Math.floor(n).toString().length),i=Math.pow(10,r).toString().substr(1);if(e<0){i="-"+i}return i+n},str_rep:function(e,t){var n="";for(;;){if(t&1){n+=e}t>>=1;if(t){e+=e}else{break}}return n},getExtension:function(e){return e.match(/(?:(?:[\w\W]+)\.)([\w\W]+?)(\?|$)/)[1].toLowerCase()},btoa:function(t){var n,r="",i=t.length||t.byteLength,s,o,u;for(n=0;n<i-2;n+=3){s=t[n]&255;o=t[n+1]&255;u=t[n+2]&255;r+=e[s>>>2];r+=e[(s&3)<<4|o>>>4];r+=e[(o&15)<<2|u>>>6];r+=e[u&63]}switch(i%3){case 2:r+=e[(t[n]&255)>>>2];r+=e[(t[n]&3)<<4|t[n+1]>>>4];r+=e[(t[n+1]&15)<<2];r+="=";break;case 1:r+=e[(t[n]&255)>>>2];r+=e[(t[n]&3)<<4];r+="==";break}return r},atob:function(t){var n=[],r,i,s,o,u,a,f="",l=0;var c=/[^A-Za-z0-9\+\/\=]/g;if(c.exec(t)){return null}do{o=e.indexOf(t.charAt(l++))>>>0;u=e.indexOf(t.charAt(l++))>>>0;a=e.indexOf(t.charAt(l++))>>>0;f=e.indexOf(t.charAt(l++))>>>0;r=o<<2|u>>>4;i=(u&15)<<4|a>>>2;s=(a&3)<<6|f;n.push(r);if(a!=64){n.push(i)}if(f!=64){n.push(s)}}while(l<t.length);return n}}})();(function(){"use strict";glib.Message=glib.Class({static$:{leftMouseDown:1,leftMouseUp:2,rightMouseDown:3,rightMouseUp:4,mouseMove:5,touchStart:6,touchEnd:7,touchMove:8,keyDown:9,keyUp:10},$:function(e,t){this.type=e;this.global=t}});glib.MouseMessage=glib.Class({inherit$:glib.Message,$:function(e,t,n){glib.Message.call(this,e);this.position=t},x:glib.Property({get:function(){return this.position.x}}),y:glib.Property({get:function(){return this.position.y}})});glib.TouchMessage=glib.Class({inherit$:glib.Message,$:function(e,t,n){glib.Message.call(this,e,n);this.position=t},x:glib.Property({get:function(){return this.position.x}}),y:glib.Property({get:function(){return this.position.y}})});glib.KeyDownMessage=glib.Class({inherit$:glib.Message,$:function(e,t){glib.Message.call(this,glib.Message.keyDown,true);this.name=e;this.key=t}});glib.KeyUpMessage=glib.Class({inherit$:glib.Message,$:function(e,t){glib.Message.call(this,glib.Message.keyUp,true);this.name=e;this.key=t}});glib.EventHandler=glib.Class({$:function(e,t,n){this.target=e;this.context=t;this.oneOff=n}});glib.EventSource=glib.Class({$:function(){this.eventSourceData={handlers:{}}},addEventHandler:function(e,t,n,r){var i=this.eventSourceData,s=n||this;if(!i.handlers.hasOwnProperty(e)){i.handlers[e]=[]}i.handlers[e].push(new glib.EventHandler(t,s,r))},clearEventHandlers:function(){var e=this.eventSourceData,t,n;for(t in e.handlers){e.handlers[t].length=0}e.handlers={}},removeEventHandler:function(e,t){var n=this.eventSourceData,r,i=n.handlers[e];if(i){while(true){r=i.indexOf(t);if(r===-1){break}i.splice(r,1)}}},dispatchEvent:function(e){var t=this.eventSourceData,n=t.handlers[e],r,i;if(n){for(r=0;r<n.length;++r){i=n[r].target.apply(n[r].context,Array.prototype.slice.call(arguments,1));if(n[r].oneOff){n.splice(r,1)}if(i===true){break}}}}})})();(function(){"use strict";var e,t,n,r,i;glib.Random=glib.Class({$:function(e){e=e||Date.now()>>>0;this.seed(e)},seed:function(s){e=123456789;t=362436069;n=521288629;r=88675123;i=s},next:function(){var s=(e^e>>>7)>>>0;e=t;t=n;n=r;r=i;i=i^i<<6^(s^s<<13)>>>0;return(t+t+1)*i>>>16}})})();glib.Cookies=function(){"use strict";return{set:function(e,t,n){var r=new Date,i;r.setTime(r.getTime()+(n||1)*24*60*60*1e3);i="expires="+r.toGMTString();document.cookie=e+"="+t+"; "+i+";path=/"},get:function(e){var t=e+"=",n,r,i,s;n=document.cookie.split(";");for(r=0;r<n.length;r++){i=n[r].trim();if(i.indexOf(t)===0){s=decodeURIComponent(i.substring(t.length,i.length));return s}}return null},remove:function(e){glib.Cookies.set(e,"X",-1)}}}();(function(){"use strict";function e(e,t,n,r,i,s,o,u){var a=u===undefined?false:u,f;if(glib.Browser.type==="MSIE"&&glib.Browser.version<=10&&u){f=new XDomainRequest;f.open(i,e);f.onerror=function(){};f.onprogress=function(){};f.timeout=5e3;f.ontimeout=function(){f.status=408;f.responseText="";t.call(r,e,f)};f.onload=function(){if(f.responseText){f.status=200}t.call(r,e,f)}}else{f=new XMLHttpRequest;f.open(i,e);if(o){f.responseType="arraybuffer"}f.onreadystatechange=function(){var n;console.log(e+" : "+f.status.toString());if(f.readyState===XMLHttpRequest.DONE){n=f.getResponseHeader("Content-Type");t.call(r,e,f)}};f.ontimeout=function(){t.call(r,e,f)};addEventListener(f,"error",function(){console.log("Error!")});f.onprogress=function(t){if(n){n.call(r,e,t)}};if(i==="POST"){f.setRequestHeader("Content-type","application/x-www-form-urlencoded")}}f.send(s);return f}glib.ajax=glib.Class({static$:{url:function(e,t,n){var r=[],i,s,o="",u="?";for(i in t){r.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));o="?";u="&"}s=e+o+r.join("&")+(n?u+(new Date).getTime()+"=1":"");return s},get:function(t,n,r,i,s,o){e(t,n,r,i,"GET",null,s,o)},post:function(t,n,r,i,s,o,u){var a=[],f;for(f in n){a.push(encodeURIComponent(f)+"="+encodeURIComponent(n[f]))}e(t,r,i,s,"POST",a.join("&"),o,u)}}})})();glib.List=function(){"use strict";function r(e,t){var n={item:null,next:e,prev:t};e.prev=n;t.next=n;return n}function i(e,s){var o,u,a,f,l,c,h,p,d,v,m;if(e>2){o=e>>>1;u=e-o;a=s.next;for(m=0;m<o;m+=1){a=a.next}f=r(s.next,a.prev);l=r(a,s.prev);i(o,f);i(u,l);p=l;v=f.next;while(v!==f){do{p=p.next}while(p!==l&&t.call(n,p.item,v.item)>0);if(p!==l){d=v;do{v=v.next}while(v!==f&&t.call(n,v.item,p.item)>=0);d.prev=p.prev;p.prev.next=d;p.prev=v.prev;v.prev.next=p}else{v.prev=l.prev;l.prev.next=v;l.prev=f.prev;f.prev.next=l;break}}l.next.prev=s;l.prev.next=s;s.prev=l.prev;s.next=l.next}else if(e===2&&t.call(n,s.prev.item,s.next.item)>0){c=s.next;h=s.prev;s.next=h;s.prev=c;c.next=s;c.prev=h;h.next=c;h.prev=s}}var e=function(e){this.nodeName=e;this.root={item:null,next:null,prev:null};this.root.next=this.root;this.root.prev=this.root;this.size=0},t,n;e.prototype={sort:function(e,r){t=e;n=r;i(this.size,this.root)},empty:function(){return this.size===0},clear:function(){this.root.next=this.root;this.root.prev=this.root;this.size=0},headNode:function(){return this.root.next},begin:function(){return this.root.next},end:function(){return this.root},tailNode:function(){return this.root.prev},head:function(){return this.root.next.item},tail:function(){return this.root.prev.item},next:function(e){return e[this.nodeName].next.item},prev:function(e){return e[this.nodeName].prev.item},insertBefore:function(e,t){var n=e[this.nodeName],r=t[this.nodeName];r.next=n;r.prev=n.prev;n.next.prev=r;n.prev=r;this.size+=1},insertAfter:function(e,t){var n=e[this.nodeName],r=t[this.nodeName];r.prev=n;r.next=n.next;n.prev.next=r;n.next=r;this.size+=1},pushFront:function(e){var t=e[this.nodeName];t.prev=this.root;t.next=this.root.next;this.root.next.prev=t;this.root.next=t;this.size+=1},pushBack:function(e){var t=e[this.nodeName];t.prev=this.root.prev;t.next=this.root;this.root.prev.next=t;this.root.prev=t;this.size+=1},add:function(e){this.pushBack(e)},popFront:function(){if(!this.empty()){var e=this.root.next;e.prev.next=e.next;e.next.prev=e.prev;this.size-=1;return e.item}return null},popBack:function(){if(!this.empty()){var e=this.root.prev;e.prev.next=e.next;e.next.prev=e.prev;this.size-=1;return e.item}return null},removeNode:function(e){e.prev.next=e.next;e.next.prev=e.prev;this.size-=1},remove:function(e){this.removeNode(e[this.nodeName])},moveToFront:function(e){var t=e[this.nodeName];t.prev.next=t.next;t.next.prev=t.prev;this.root.next.prev=t;this.root.next=t},moveToBack:function(e){var t=e[this.nodeName];t.prev.next=t.next;t.next.prev=t.prev;this.root.prev.next=t;this.root.prev=t},forEach:function(e,t){var n=this.root.next,r,i=0;while(n!==this.root){r=n.next;if(e.call(t,n.item,i)===false){return false}n=r;i+=1}return true},reverseForEach:function(e,t){var n=this.root.prev,r,i=0;while(n!==this.root){r=n.prev;if(e.call(t,n.item,i)===false){return false}n=r;i+=1}return true},removeIf:function(e,t){var n=this.root.next,r,i=0;while(n!==this.root){r=n.next;if(e.call(t,n.item)===true){n.prev.next=r;n.next.prev=n.prev;i+=1}n=r}this.size-=i;return i},findFirstOf:function(e,t){var n=this.root.next,r,i=0;while(n!==this.root){r=n.next;if(e.call(t,n.item,i)===true){return n.item}n=r;i+=1}return null},findLastOf:function(e,t){var n=this.root.next,r,i=0;while(n!==this.root){r=n.prev;if(e.call(t,n.item,i)===true){return n.item}n=r;i-=1}return null},select:function(t,n,r){var i=new e(t),s=this.root.next,o=0,u;while(s!==this.root){u=s.next;if(n.call(r,s.item,o)===true){i.pushBack(s.item)}s=u;o+=1}return i},reverseFind:function(e,t){var n=this.root.prev,r=0,i;while(n!==this.root){i=n.prev;if(e.call(t,n.item,r)===true){return n.item}n=i;r+=1}return null},toString:function(){var e="list ("+this.size.toString()+") <",t="";this.forEach(function(n){e+=t+n.toString();t=","});return e+">"}};e.Node=function(e){return{item:e,next:null,prev:null}};return e}();(function(){"use strict";var e=[];glib.Canvas=glib.Class({static$:{create:function(t,n){var r,i,s,o,u,a,f,l;for(r=e.length-1;r>=0;--r){s=e[r];f=s.width-t;l=s.height-n;if(f>=0&&l>=0){if(f+l===0){o=s;a=r;break}if(u===undefined||f+l<u){o=s;a=r;u=f+l}}}if(o){e.splice(a,1);o.clear()}else{o=new glib.Canvas(t,n)}return o},showCache:function(){e.forEach(function(e){glib.Debug.print(e.width,e.height)})}},$:function(e,t){this.width=Math.ceil(e)>>>0;this.height=Math.ceil(t)>>>0;this.canvas=document.createElement("canvas");this.canvas.width=this.width;this.canvas.height=this.height;this.context=this.canvas.getContext("2d")},clear:function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)},destroy:function(){e.push(this)}})})();(function(){"use strict";function e(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5]}glib.Matrix=glib.Class({$:function(){this.m=[1,0,0,1,0,0]},set:function(e,t,n,r,i,s){var o=this.m;o[0]=e;o[1]=t;o[2]=n;o[3]=r;o[4]=i;o[5]=s;return this},copyTo:function(t){e(t.m,this.m)},copyFrom:function(t){e(this.m,t.m)},setIdentity:function(){this.set(1,0,0,1,0,0);return this},multiplyInto:function(e,t){var n=this.m,r=e.m,i=t.m,s=n[0]*r[0]+n[2]*r[1],o=n[1]*r[0]+n[3]*r[1],u=n[0]*r[2]+n[2]*r[3],a=n[1]*r[2]+n[3]*r[3],f=n[0]*r[4]+n[2]*r[5]+n[4],l=n[1]*r[4]+n[3]*r[5]+n[5];i[0]=s;i[1]=o;i[2]=u;i[3]=a;i[4]=f;i[5]=l;return t},multiply:function(e){return this.multiplyInto(e,this)},translate:function(e){var t=this.m;t[4]+=t[0]*e.x+t[2]*e.y;t[5]+=t[1]*e.x+t[3]*e.y;return this},translation:glib.Property({get:function(){return{x:this.m[4],y:this.m[5]}},set:function(e){this.m[4]=e.x;this.m[5]=e.y}}),scale:function(e){var t=this.m;t[0]*=e.x;t[1]*=e.x;t[2]*=e.y;t[3]*=e.y;return this},rotate:function(e){var t=this.m,n=Math.cos(e),r=Math.sin(e),i=t[0]*n+t[2]*-r,s=t[1]*n+t[3]*-r,o=t[0]*r+t[2]*n,u=t[1]*r+t[3]*n;t[0]=i;t[1]=s;t[2]=o;t[3]=u;return this},invert:function(e){var t=this.m,n=t[0]*t[3]-t[1]*t[2];if(n<1e-6){return this.copyTo(e)}n=1/n;return e.set(t[3]*n,t[1]*-n,t[2]*-n,t[0]*n,(t[2]*t[5]-t[3]*t[4])*n,(t[0]*t[5]-t[1]*t[4])*-n)},apply:function(e){var t=this.m;return{x:e.x*t[0]+e.y*t[2]+t[4],y:e.x*t[1]+e.y*t[3]+t[5]}},transform:function(e){var t=this.m,n,r,i;for(n=0;n<e.length;++n){r=e[n].x;i=e[n].y;e[n].x=r*t[0]+i*t[2]+t[4];e[n].y=r*t[1]+i*t[3]+t[5]}return e},setContextTransform:function(e){var t=this.m;e.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])}})})();(function(){"use strict";glib.Drawable=glib.Class({inherit$:glib.EventSource,$:function(){glib.EventSource.call(this);this.drawableData={position:{x:0,y:0},dimensions:{width:0,height:0},padding:{left:0,top:0,right:0,bottom:0},rotation:0,scale:{x:1,y:1},drawScale:{x:1,y:1},dirty:true,visible:true,myZindex:0,baseZindex:0,reorder:false,transparency:255,pivot:{x:0,y:0},mouseIsOver:false,matrix:new glib.Matrix,pickMatrix:new glib.Matrix,globalMatrix:new glib.Matrix,mouseCapture:false,touchCapture:false,parent:null,enabled:true,closed:false,modal:false,children:[]}},onKeyDown:function(e){},onKeyUp:function(e){},onMouseEnter:function(e){return false},onTouchEnter:function(e){return false},onTouchLeave:function(e){return false},onTouchStart:function(e){return false},onTouchEnd:function(e){return false},onTouchMove:function(e){return false},onMouseLeave:function(e){return false},onLeftMouseDown:function(e){return false},onLeftMouseUp:function(e){return false},onRightMouseDown:function(e){return false},onRightMouseUp:function(e){return false},onMouseMove:function(e){return false},onDraw:function(e){return},onUpdate:function(e,t){return},onClosed:function(){return},onLoaded:function(e){return},processMessage:function(e,t,n){var r=this.drawableData,i,s,o,u=false,a,f,l;if(this.enabled){t=t||r.mouseCapture;n=n||r.touchCapture;for(s=r.children.length-1;s>=0;--s){i=r.children[s];if(i.processMessage(e,t,n)||i.modal){return true}}if(this.visible&&this.enabled){if(e.position!==undefined){u=this.pick(e.position,0)}switch(e.type){case glib.Message.touchStart:if(u||r.touchCapture){r.isTouched=true;this.dispatchEvent("touchStart",e);return this.onTouchStart(e)}break;case glib.Message.touchEnd:this.dispatchEvent("touchEnd");r.isTouched=false;return this.onTouchEnd(e)&&false;case glib.Message.leftMouseDown:if(u||r.mouseCapture){this.dispatchEvent("leftMouseDown",e);return this.onLeftMouseDown(e)}break;case glib.Message.rightMouseDown:if(u||r.mouseCapture){this.dispatchEvent("rightMouseDown",e);return this.onRightMouseDown(e)}break;case glib.Message.leftMouseUp:if(u||r.mouseCapture){this.dispatchEvent("leftMouseUp",e);return this.onLeftMouseUp(e)}break;case glib.Message.rightMouseUp:if(u||r.mouseCapture){this.dispatchEvent("rightMouseUp",e);return this.onRightMouseUp(e)}break;case glib.Message.mouseMove:if(u||r.mouseCapture){if(!r.mouseIsOver&&u){this.onMouseEnter(e);this.dispatchEvent("mouseEnter",e)}this.dispatchEvent("mouseMove",e);r.mouseIsOver=u;return this.onMouseMove(e)}else if(r.mouseIsOver&&!u){this.dispatchEvent("mouseLeave",e);r.mouseIsOver=false;return this.onMouseLeave(e)}break;case glib.Message.touchMove:if(u||r.touchCapture){if(!r.isTouched&&u){this.dispatchEvent("touchEnter",e)}r.isTouched=true;this.dispatchEvent("touchMove",e);return this.onTouchMove(e)}else if(r.isTouched&&!u){r.isTouched=false;this.dispatchEvent("touchLeave",e);return this.onTouchLeave(e)}break;case glib.Message.keyDown:this.dispatchEvent("keyDown",e);this.onKeyDown(e);break;case glib.Message.keyUp:this.dispatchEvent("keyUp",e);this.onKeyUp(e);break}}}return false},loaded:function(e){var t=this.drawableData,n,r,i;this.dispatchEvent("loaded");this.onLoaded(e);for(r=0,i=t.children.length;r<i;++r){n=t.children[r];n.loaded(e)}},update:function(e,t){var n=this.drawableData,r,i,s,o,u,a=false;for(i=0;i<n.children.length;++i){r=n.children[i];if(r.drawableData.closed){r.dispatchEvent("closed");r.onClosed();r.drawableData.closed=false;n.children.splice(i,1)}}if(n.enabled){for(i=n.children.length-1;i>=0;--i){r=n.children[i];r.update(e,t);if(r.drawableData.modal&&!a){glib.Mouse.freeze();glib.Keyboard.freeze();a=true}}if(n.enabled){this.onUpdate(e,t)}}if(a){glib.Mouse.unfreeze();glib.Keyboard.unfreeze()}},draw:function(e,t,n){var r=this.drawableData,i,s,o,u;if(r.visible){if(r.reorder){for(s=0,o=r.children.length;s<o;++s){r.children[s].drawableData.baseZindex=s}r.children.sort(function(e,t){var n=e.drawableData.myZindex-t.drawableData.myZindex;if(n!==0){return n}return e.drawableData.baseZindex-t.drawableData.baseZindex});r.reorder=false}t.multiplyInto(this.drawMatrix(),r.globalMatrix);r.globalMatrix.invert(r.pickMatrix);r.globalMatrix.setContextTransform(e);u=n*r.transparency/255;e.globalAlpha=u/255;if(this.onDraw(e)!==false){for(s=0,o=r.children.length;s<o;++s){r.children[s].draw(e,r.globalMatrix,u)}}}},debug:function(){var e=this.drawableData,t,n,r;glib.Debug.text(e.matrix.m[4],e.matrix.m[5],e.dirty);for(n=0,r=e.children.length;n<r;++n){t=e.children[n];t.item.debug()}},setPivot:function(e,t){this.drawableData.pivot.x=e;this.drawableData.pivot.y=t;this.drawableData.dirty=true;return this},setRotation:function(e){this.drawableData.rotation=e;this.drawableData.dirty=true;return this},setPosition:function(e,t){this.drawableData.position.x=e;this.drawableData.position.y=t;this.drawableData.dirty=true;return this},move:function(e,t){this.drawableData.position.x+=e;this.drawableData.position.y+=t;this.drawableData.dirty=true;return this},setScale:function(e,t){this.drawableData.scale.x=e;this.drawableData.scale.y=t!==undefined?t:e;this.drawableData.dirty=true;return this},setFlip:function(e,t){this.drawableData.drawScale.x=e?-1:1;this.drawableData.drawScale.y=t?-1:1;this.drawableData.dirty=true;return this},refreshMatrix:function(){var e=this.drawableData,t,n;t={x:-e.pivot.x*this.width,y:-e.pivot.y*this.height};n={x:e.scale.x*e.drawScale.x,y:e.scale.y*e.drawScale.y};e.matrix.setIdentity().translate(e.position).rotate(e.rotation).scale(n).translate(t);e.dirty=false},setCapture:function(e){this.drawableData.mouseCapture=e;this.drawableData.touchCapture=e;return this},screenToClient:function(e){var t=this.drawableData;return t.pickMatrix.apply(e)},clientToScreen:function(e){var t=this.drawableData;return t.globalMatrix.apply(e)},drawMatrix:function(){var e=this.drawableData;if(e.dirty){this.refreshMatrix()}return e.matrix},pick:function(e){var t=this.screenToClient(e);return t.x>=0&&t.y>=0&&t.x<this.width&&t.y<this.height},removeChild:function(e){var t=this.drawableData.children.indexOf(e);if(t!==-1){e.drawableData.parent=null;this.drawableData.children.splice(t,1)}},removeChildren:function(){var e=this.drawableData,t;while(e.children.length>0){t=e.children.shift();t.drawableData.parent=null}},addChild:function(e){var t=this.drawableData;e.drawableData.parent=this;t.children.push(e);t.reorder=true;return this},addSibling:function(e){this.drawableData.parent.addChild(e);return this},close:function(){this.dispatchEvent("closing");this.drawableData.closed=true;return this},getScreenExtent:function(){var e,t,n,r=this.drawableData.extent,i=[{x:r.left,y:r.top},{x:r.right,y:r.top},{x:r.right,y:r.bottom},{x:r.left,y:r.bottom}];this.drawableData.globalMatrix.transform(i);t={x:i[0].x,y:point[0].y};n={x:i[0].x,y:point[0].y};for(e=1;e<4;++e){t.x=Math.min(t.x,i[e].x);t.y=Math.min(t.y,i[e].y);n.x=Math.max(n.x,i[e].x);n.y=Math.max(n.y,i[e].y)}return{left:t.x,top:t.y,right:n.x,bottom:n.y}},rotation:glib.Property({get:function(){return this.drawableData.rotation},set:function(e){this.drawableData.rotation=e;this.drawableData.dirty=true}}),position:glib.Property({get:function(){return this.drawableData.position},set:function(e){this.drawableData.position.x=e.x;this.drawableData.position.y=e.y;this.drawableData.dirty=true}}),x:glib.Property({get:function(){return this.drawableData.position.x},set:function(e){this.drawableData.position.x=e;this.drawableData.dirty=true}}),y:glib.Property({get:function(){return this.drawableData.position.y},set:function(e){this.drawableData.position.y=e;this.drawableData.dirty=true}}),size:glib.Property({get:function(){return this.drawableData.dimensions},set:function(e){this.drawableData.dimensions.width=e.width;this.drawableData.dimensions.height=e.height;this.drawableData.dirty=true}}),width:glib.Property({configurable:true,get:function(){return this.drawableData.dimensions.width},set:function(e){this.drawableData.dimensions.width=e;this.drawableData.dirty=true}}),height:glib.Property({configurable:true,get:function(){return this.drawableData.dimensions.height},set:function(e){this.drawableData.dimensions.height=e;this.drawableData.dirty=true}}),scale:glib.Property({get:function(){return this.drawableData.scale},set:function(e){this.drawableData.scale.x=e.x;this.drawableData.scale.y=e.y;this.drawableData.dirty=true}}),zIndex:glib.Property({set:function(e){var t=this.drawableData;t.myZindex=e;if(t.parent!==null){t.parent.drawableData.reorder=true}},get:function(){return this.drawableData.myZindex}}),parent:glib.Property({get:function(){return this.drawableData.parent}}),enabled:glib.Property({get:function(){return this.drawableData.enabled},set:function(e){this.drawableData.enabled=e}}),visible:glib.Property({set:function(e){this.drawableData.visible=e},get:function(){return this.drawableData.visible}}),transparency:glib.Property({set:function(e){this.drawableData.transparency=e},get:function(){return this.drawableData.transparency}}),modal:glib.Property({set:function(e){this.drawableData.modal=e},get:function(){return this.drawableData.modal}}),setDirty:function(){this.drawableData.dirty=true}})})();(function(){"use strict";var e,t;glib.Timer=glib.Class({inherit$:glib.Drawable,static$:{init:function(){e=performance.now()},update:function(){var n=performance.now();t=n-e;e=n},time:glib.Property({get:function(){return e}}),delta:glib.Property({get:function(){return t}})},$:function(e,t,n,r){glib.Drawable.call(this);this.timeout=t;this.age=e;this.callback=n;this.context=r},onUpdate:function(e,t){this.age-=t;if(this.age<=0){if(this.timeout){this.age=this.timeout}else if(this.parent){this.close()}if(this.callback.call(this.context)===false){this.parent.removeChild(this)}}}})})();(function(){"use strict";glib.Composite=glib.Class({static$:{identityMatrix:new glib.Matrix},$:function(){this.compositeData={canvas:null,dirty:false,oldOnDraw:this.onDraw,oldDraw:new glib.Matrix,oldPick:new glib.Matrix,oldGlobal:new glib.Matrix,oldTransparency:0};this.composable=true},composite_compose:function(){var e,t,n,r=this.drawableData,i=this.compositeData;t=this.width+r.padding.left+r.padding.right+1;n=this.height+r.padding.top+r.padding.bottom+1;if(i.canvas===null||t>i.canvas.width||n>i.canvas.height){if(i.canvas!==null){i.canvas.destroy()}i.canvas=glib.Canvas.create(t,n)}else{i.canvas.clear()}this.oldTransparency=r.transparency;this.drawMatrix().copyTo(i.oldDraw);r.pickMatrix.copyTo(i.oldPick);r.globalMatrix.copyTo(i.oldGlobal);r.matrix.setIdentity();this.transparency=255;this.onDraw=i.oldOnDraw;glib.Composite.identityMatrix.translation={x:r.padding.left,y:r.padding.top};this.draw(i.canvas.context,glib.Composite.identityMatrix,255);this.onDraw=this.composite_draw;r.transparency=this.oldTransparency;this.drawMatrix().copyFrom(i.oldDraw);r.pickMatrix.copyFrom(i.oldPick);r.globalMatrix.copyFrom(i.oldGlobal);i.dirty=false},composite_draw:function(e){var t=this.compositeData,n=this.drawableData;if(t.dirty){this.composite_compose()}e.drawImage(t.canvas.canvas,-n.padding.left,-n.padding.top);return false},compose:function(){var e=this.compositeData;e.dirty=true;if(this.composable){this.onDraw=this.composite_draw}},decompose:function(){this.onDraw=this.compositeData.oldOnDraw}})})();(function(){"use strict";var e=glib.Class({static$:{items:{},get:function(t){if(e.items[t]!==undefined){return e.items[t].object}return undefined},put:function(t,n,r){e.items[t]={object:n,size:r}},dump:function(){var t;console.log("{");for(t in e.items){console.log('   "'+t+'": '+e.items[t].size.toString()+",")}console.log("}")}}}),t="R0lGODlhHAAeAKIAAMDAwICAgKyomfHv4v8AAAAAAP///wAAACH5BAAAAAAALAAAAAAcAB4AA"+"AOAKLrc7kOYSau9NuLNp+5g9YXhSHbmuaVG4L4wfLEBCBSzZNXdnV88ji+jqwQ3Q1GREiQQJs5"+"JkkKrOKNSHBFowWZ/O+uVMvUsJ82nAVs2VHtaJRcONtri1HPrXmcC/oCBf3hmFwWHiImJfSoYL"+"I1ykCt6koWVjJduA5ucnZ6foAkAOw==",n=glib.Class({inherit$:glib.EventSource,$:function(e,t,r,i){var s;glib.EventSource.call(this);this.url=e;this.size=null;this.bytesReceived=0;this.data=t;this.loaded=false;this.loader=r;this.inProgress=false;this.binary=undefined;this.started=false;if(i===undefined){s=glib.Util.getExtension(e)}else{s=i}switch(s){case"jpg":case"jpeg":this.object=new Image;this.binary=true;this.finalize=n.processJPEG;break;case"png":this.object=new Image;this.binary=true;this.finalize=n.processImage;break;case"json":this.object={};this.binary=false;this.finalize=n.processJSON;break;default:this.object=new Uint8Array;this.binary=true;this.finalize=n.processBinary;break}},load:function(){var t;if(!this.started){this.started=true;t=e.get(this.url);if(t!==undefined){this.inProgress=true;this.loaded=true;this.object=t;this.doCallback()}else{glib.ajax.get(this.url,n.onLoaded,n.onProgress,this,this.binary)}}},doCallback:function(){this.dispatchEvent("loaded",this.object)},then:function(e,t){if(this.loaded){t.call(e,this.object)}else{this.addEventHandler("loaded",t,e,true)}},static$:{onProgress:function(e,t){this.inProgress=true;if(t.lengthComputable&&this.size===null){this.size=t.total}this.bytesReceived=t.loaded},onLoaded:function(t,r){var i=null,s=null,o=r.status,u=r.getResponseHeader("Content-Type");if(o==200){switch(u){case"image/png":i=glib.Util.getResponseAsArray(r);s=n.processImage;break;case"image/jpeg":i=glib.Util.getResponseAsArray(r);s=n.processJPEG;break;case"text/plain":case"application/json":i=r.responseText;s=n.processJSON;break;default:console.log("Unknown Content-Type: "+u);i=r.responseText;s=n.processText;break}}else{}if(s!==null&&i!==null){s.call(this,i);e.put(this.url,this.object,i.length)}this.inProgress=true;this.loaded=true;this.doCallback()},processImage:function(e){if(e){this.object.src="data:image/png;base64,"+glib.Util.btoa(e)}else{this.object.src="data:image/gif;base64,"+t}},processJPEG:function(e){if(e){this.object.src="data:image/jpeg;base64,"+glib.Util.btoa(e)}else{this.object.src="data:image/gif;base64,"+t}},processJSON:function(e){var t;if(e){try{t=JSON.parse(e);glib.Util.shallowCopy(t,this.object)}catch(n){}}else{}},processText:function(e){},processBinary:function(e){if(e){this.object.set(e,0)}}}});glib.Loader=glib.Class({inherit$:[glib.Drawable,glib.EventSource],static$:{dumpCacheManifest:function(){e.dump()}},$:function(e){glib.Drawable.call(this);glib.EventSource.call(this);this.baseDir=e||"";this.items={}},percentComplete:function(){var e,t=0,n=0;for(e in this.items){if(this.items[e].size!==undefined){t+=this.items[e].size}n+=this.items[e].bytesReceived}t=t||n;return n>0?n*100/t:0},complete:function(){var e;for(e in this.items){if(!this.items[e].loaded){return false}}return true},onUpdate:function(){var e,t,n;glib.Debug.print("Loading, "+this.percentComplete().toFixed(0)+"% complete...");glib.Debug.print();for(e in this.items){t=this.items[e];n=t.bytesReceived.toString();while(n.length<20){n=" "+n}glib.Debug.print(n+": "+t.url)}},reset:function(e){this.baseDir=e||this.baseDir;this.items={}},start:function(){var e;for(e in this.items){this.items[e].load()}},itemLoaded:function(e){if(this.complete()){if(this.parent!==null){this.parent.loaded(this)}this.dispatchEvent("complete")}},loadItem:function(e,t,r,i){var s=glib.ajax.url(this.baseDir+e,i),o=this.items[s];if(o===undefined){o=new n(s,i,this);this.items[s]=o}o.load();return o},load:function(e,t,r,i,s){var o=glib.ajax.url(this.baseDir+e,i),u=this.items[o];if(u===undefined){u=new n(o,i,this,s);this.items[o]=u}if(t){u.addEventHandler("loaded",t,r)}u.addEventHandler("loaded",this.itemLoaded,this);return u.object}})})();(function(){"use strict";glib.Image=glib.Class({inherit$:glib.Drawable,$:function(e){var t=this;glib.Drawable.call(this);this.loaded=false;this.image=new Image;this.image.onload=function(){t.size={width:t.image.width,height:t.image.height};t.loaded=true;t.dispatchEvent("loaded");t.onDraw=t.realOnDraw};if(e){this.image.src=e}},scaleTo:function(e,t){this.setScale(e/this.width,t/this.height);return this},src:glib.Property({set:function(e){this.image.src=e}}),onDraw:function(e){},realOnDraw:function(e){var t=this.width,n=this.height;e.drawImage(this.image,0,0,t,n,0,0,t,n)}})})();(function(){"use strict";glib.Sprite=glib.Class({inherit$:glib.Drawable,$:function(e){glib.Drawable.call(this);this.image=e;this.UV={x:0,y:0};this.framesWide=1;this.framesHigh=1;this.frameWidth=null;this.frameHeight=null;this.frame=0},static$:{load:function(e,t){return new glib.Sprite(t.load(e+".png"))}},setFrameXY:function(e,t){this.UV.x=e*this.frameWidth;this.UV.y=t*this.frameHeight},setFrame:function(e){this.setFrameXY(e%this.framesWide>>>0,e/this.framesWide>>>0)},width:glib.Property({get:function(){return this.frameWidth||this.image.width}}),height:glib.Property({get:function(){return this.frameHeight||this.image.height}}),size:glib.Property({get:function(){return{width:this.width,height:this.height}}}),scaleTo:function(e,t){this.setScale(e/this.width,t/this.height);return this},onDraw:function(e,t){var n=this.width,r=this.height;e.drawImage(this.image,this.UV.x,this.UV.y,n,r,0,0,n,r)}})})();(function(){"use strict";glib.Button=glib.Class({inherit$:glib.EventSource,static$:{idle:0,hover:1,pressed:2},$:function(e,t){this.currentState=glib.Button.idle;this.callback=e;this.context=t||this},onHover:function(){},onIdle:function(){},onPressed:function(){},onClicked:function(){},onTouchStart:function(){this.state=glib.Button.pressed;return true},onTouchEnd:function(e){if(this.state===glib.Button.pressed){this.state=glib.Button.idle;this.dispatchEvent("clicked",this);if(this.callback){this.callback.call(this.context||this)}}return true},onTouchEnter:function(){return true},onTouchLeave:function(){this.state=glib.Button.idle;return true},onMouseEnter:function(){this.state=glib.Button.hover;return true},onMouseLeave:function(){this.state=glib.Button.idle;return true},onLeftMouseDown:function(){this.state=glib.Button.pressed;return true},onLeftMouseUp:function(){if(this.state===glib.Button.pressed){this.state=glib.Button.hover;this.onClicked();this.dispatchEvent("clicked");if(this.callback){this.callback.call(this.context||this)}}return true},state:glib.Property({get:function(){return this.currentState},set:function(e){if(this.currentState!=e){this.currentState=e;switch(e){case glib.Button.idle:this.dispatchEvent("idle");this.onIdle();break;case glib.Button.hover:this.dispatchEvent("hover");this.onHover();break;case glib.Button.pressed:this.dispatchEvent("pressed");this.onPressed();break}}}})})})();(function(){"use strict";glib.Rectangle=glib.Class({inherit$:glib.Drawable,$:function(e,t,n,r,i){glib.Drawable.call(this);this.setPosition(e,t);this.size={width:n,height:r};this.radius=i!==undefined?i:0},onDraw:function(e){if(this.radius>0){glib.Util.roundRect(e,0,0,this.width,this.height,this.radius)}else{glib.Util.rect(e,0,0,this.width,this.height)}}});glib.ClipRect=glib.Class({inherit$:glib.Rectangle,$:function(e,t,n,r,i){glib.Rectangle.call(this,e,t,n,r,i)},onDraw:function(e){glib.Rectangle.prototype.onDraw.call(this,e);e.clip()}});glib.SolidRectangle=glib.Class({inherit$:glib.Rectangle,$:function(e,t,n,r,i,s){glib.Rectangle.call(this,e,t,n,r,i);this.fillColour=s},drawIt:function(e){e.fillStyle=this.fillColour;e.fill()},onDraw:function(e){glib.Rectangle.prototype.onDraw.call(this,e);this.drawIt(e)}});glib.OutlineRectangle=glib.Class({inherit$:glib.Rectangle,$:function(e,t,n,r,i,s,o){glib.Rectangle.call(this,e,t,n,r,i);this.lineColour=s;this.lineWidth=o===undefined?1:o},drawIt:function(e){e.lineWidth=this.lineWidth;e.strokeStyle=this.lineColour;e.stroke()},onDraw:function(e){glib.Rectangle.prototype.onDraw.call(this,e);this.drawIt(e)}});glib.Panel=glib.Class({inherit$:glib.Rectangle,$:function(e,t,n,r,i,s,o,u){glib.Rectangle.call(this,e,t,n,r,o);this.fillColour=i;this.lineColour=s;this.lineWidth=u||1},onDraw:function(e){glib.Rectangle.prototype.onDraw.call(this,e);if(this.fillColour!==undefined){glib.SolidRectangle.prototype.drawIt.call(this,e)}if(this.lineColour!==undefined){glib.OutlineRectangle.prototype.drawIt.call(this,e)}}});glib.Line=glib.Class({inherit$:glib.Drawable,$:function(e,t,n,r,i,s){glib.Drawable.call(this);this.x1=e;this.x2=n;this.y1=t;this.y2=r;this.colour=i;this.lineWidth=s},onDraw:function(e){e.beginPath();e.moveTo(this.x1,this.y1);e.lineTo(this.x2,this.y2);e.strokeStyle=this.colour;e.lineWidth=this.lineWidth;e.stroke()}});glib.PanelButton=glib.Class({inherit$:[glib.Button,glib.Composite,glib.Panel],$:function(e,t,n,r,i,s,o,u,a,f){glib.Button.call(this,a,f);glib.Composite.call(this);glib.Panel.call(this,e,t,n,r,i,s,o,u)}});glib.LinkButton=glib.Class({inherit$:[glib.Button,glib.Line],$:function(e,t,n,r,i,s,o){var u=Math.floor(e)+.5,a=Math.floor(n)+.5,f=Math.floor(t)+.5,l=Math.floor(r)+.5,c=l-f,h=a-u;glib.Line.call(this,0,c,h,c,"skyblue",2);glib.Button.call(this,function(){if(this.linkClicked){this.linkClicked.call(this.clickContext,this.link)}},this);this.clickContext=o;this.link=i;this.linkClicked=s;this.setPosition(u,f);this.size={width:h,height:c}},onIdle:function(){this.colour="skyblue"},onHover:function(){this.colour="red"},onPressed:function(){this.colour="white"}})})();(function(){"use strict";var e=function(){var e=this.labelData,t=this.drawableData.padding;e.extent=this.labelData.font.measureText(this.labelData.text);this.size={width:e.extent.width,height:e.extent.height};t.left=-e.extent.left;t.top=-e.extent.top;t.right=e.extent.right-e.extent.width;t.bottom=e.extent.bottom-e.extent.height};glib.Label=glib.Class({inherit$:[glib.Composite,glib.Drawable],$:function(t,n){glib.Drawable.call(this);glib.Composite.call(this);this.labelData={text:t,font:n,extent:null};e.call(this);this.compose()},text:glib.Property({configurable:true,get:function(){return this.labelData.text},set:function(t){if(this.labelData.text!==t){this.labelData.text=t;e.call(this);this.compose()}}}),font:glib.Property({get:function(){return this.labelData.font},set:function(t){if(this.labelData.font!==t){this.labelData.font=t;e.call(this);this.compose()}}}),onDraw:function(e){var t=this.labelData;t.font.renderString(e,t.text,.5,.5)}});var t=function(e){if(this.linkClicked!==undefined){this.linkClicked.call(this.context,e)}};glib.TextBox=glib.Class({inherit$:glib.ClipRect,$:function(e,t,n,r,i,s,o,u,a){glib.ClipRect.call(this,e,t,n,r,0);if(u){this.links=new glib.Drawable;this.addChild(this.links)}this.label=new glib.Label(i,s);this.addChild(this.label);this.context=a;this.setPosition(e,t);this.linkClicked=u;this.lineBreak=o||"\r";this.text=i},text:glib.Property({set:function(e){var n=[],r;this.label.text=this.label.font.wrapText(e,this.width,this.lineBreak);if(this.linkClicked){this.label.font.measureText(this.label.text,n);this.links.removeChildren();while(n.length>0){r=new glib.LinkButton(n.shift(),n.shift(),n.shift(),n.shift(),n.shift(),t,this);r.transparency=192;this.links.addChild(r)}}},get:function(e){return this.label.text}})})})();(function(){"use strict";glib.Font=glib.Class({static$:{load:function(e,t){return new glib.Font(t.load(e+".json"),t.load(e+"0.png"))}},$:function(e,t){this.page=t;this.font=e;this.lineSpacing=0;this.softLineSpacing=0;this.letterSpacing=0;this.mask=255},midPivot:glib.Property({get:function(){return this.font.baseline/this.font.height/2}}),baselinePivot:glib.Property({get:function(){return this.font.baseline/this.font.height}}),height:glib.Property({get:function(){return this.font.height}}),baseline:glib.Property({get:function(){return this.font.baseline}}),renderString:function(e,t,n,r){var i,s,o,u,a,f,l,c,h=false,p=false,d=false,v=this.lineSpacing,m=this.softLineSpacing;for(i=0;i<this.font.layerCount;++i){if(1<<i&this.mask){o=this.font.Layers[i];u=n+o.offsetX;a=r+o.offsetY;for(s=0;s<t.length;++s){f=t[s];if(!p){switch(f){case"\n":u=o.offsetX;a+=this.font.height+v;d=true;break;case"\r":u=o.offsetX;a+=this.font.height+m;d=true;break;case"\\":p=true;d=true;break;case"@":h=!h;d=true;break;default:d=false;break}}if(!d){f=this.font.charMap[f.charCodeAt(0)];if(f!==undefined){c=this.font.glyphs[f];if(i<c.imageCount){l=c.images[i];e.drawImage(this.page,l.x,l.y,l.w,l.h,u+l.offsetX,a+l.offsetY,l.w,l.h)}u+=c.advance}}}}}},measureText:function(e,t,n){var r=n===undefined?this.font.layerCount-1:n,i,s,o=0,u=0,a,f,l,c,h,p,d=false,v=false,m=false,g="",y=0,b=0,w=0,E=0,S=this.softLineSpacing,x=this.lineSpacing;if(t){t.length=0}for(i=0;i<this.font.layerCount;++i){s=this.font.Layers[i];a=s.offsetX;f=s.offsetY;for(l=0;l<e.length;++l){c=e[l];if(!v){switch(c){case"\n":a=s.offsetX;f+=this.font.height+x;m=true;break;case"\r":a=s.offsetX;f+=this.font.height+S;m=true;break;case"\\":v=true;m=true;break;case"@":d=!d;m=true;if(t&&i===0){if(d){t.push(a,f)}else{t.push(a,f+this.font.baseline+3,g);g=""}}break;default:m=false;break}}if(!m){if(d){g+=c}c=this.font.charMap[c.charCodeAt(0)];if(c!==undefined){h=this.font.glyphs[c];if(i<h.imageCount){p=h.images[i];y=Math.min(p.offsetX+a,y);b=Math.max(p.offsetX+p.w+a,b);w=Math.min(p.offsetY+f,w);E=Math.max(p.offsetY+p.h+f,E)}a+=h.advance;if(i===r){o=Math.max(a,o)}}}}}return{width:o,height:f+this.font.height,left:y,right:b,top:w,bottom:E}},wrapText:function(e,t,n){var r=1,i,s,o;while(this.measureText(e).width>=t){s=-1;for(i=r;i<e.length;++i){if(e[i]===" "){o=e.slice(0,i);if(this.measureText(o).width>=t){break}s=i}}if(s===-1){break}r=s;if(r>=e.length){break}e=e.slice(0,r)+n+e.slice(r+1);r+=n.length}return e}})})();(function(){"use strict";glib.TextButton=glib.Class({inherit$:[glib.Button,glib.Drawable],$:function(e,t,n,r,i,s,o,u,a,f){var l=f===undefined?true:false;glib.Button.call(this,o,u);glib.Drawable.call(this);this.idleFillColour="darkSlateGrey";this.hoverFillColour="slateGrey";this.pressedFillColour="lightSlateGrey";if(!l){this.idleLineColour=undefined;this.hoverLineColour=undefined;this.pressedLineColour=undefined}else{this.idleLineColour="white";this.hoverLineColour="white";this.pressedLineColour="darkSlateGrey"}this.label=new glib.Label(e,t);this.size={width:Math.max(i,this.label.width+16),height:s};this.setPosition(n,r);this.panel=new glib.Panel(0,0,this.width,s,"darkSlateGrey",this.idleLineColour,a===undefined?s/3:a,3);this.addChild(this.panel);this.label.setPivot(.5,t.midPivot);this.label.setPosition(this.width/2,this.height/2);this.addChild(this.label)},text:glib.Property({set:function(e){this.label.text=e},get:function(){return this.label.text}}),onHover:function(){this.panel.lineColour=this.hoverLineColour;this.panel.fillColour=this.hoverFillColour},onIdle:function(){this.panel.lineColour=this.idleLineColour;this.panel.fillColour=this.idleFillColour},onPressed:function(){this.panel.lineColour=this.pressedLineColour;this.panel.fillColour=this.pressedFillColour}})})();(function(){"use strict";glib.SpriteButton=glib.Class({inherit$:[glib.Button,glib.Sprite],$:function(e,t,n,r,i,s){glib.Button.call(this,i,s);glib.Sprite.call(this,e);this.setPivot(.5,.5);this.type=t;this.setPosition(n,r);this.origin={x:n,y:r}},onIdle:function(){switch(this.type){case"frame":this.setFrame(0);break;case"offset":this.setPosition(this.origin.x,this.origin.y);break;case"scale":this.setScale(1);break}},onHover:function(){switch(this.type){case"frame":this.setFrame(1);break;case"offset":this.setPosition(this.origin.x-1,this.origin.y-1);break;case"scale":this.setScale(1.25);break}},onPressed:function(){switch(this.type){case"frame":this.setFrame(2);break;case"offset":this.setPosition(this.origin.x+2,this.origin.y+2);break;case"scale":this.setScale(1.5);break}}})})();(function(){"use strict";glib.Menu=glib.Class({inherit$:glib.Drawable,$:function(e,t,n,r,i,s){var o,u=n.height,a=0,f,l=0,c,h,p,d;for(o=0;o<r.length;++o){c=r[o];a=Math.max(a,n.measureText(c).width+8)}a+=32;f=(n.height+16)*r.length;glib.Drawable.call(this);this.setPosition(e,t);this.size={width:a,height:f};this.clip=new glib.ClipRect(0,0,a,f,6);this.addChild(this.clip);this.transparency=224;this.font=n;this.setPosition(e,t);this.buttons=[];o=0;r.forEach(function(e){var t=e[0],r=.5,u=.5,f;if(t!=="<"&&t!==">"&&t!=="\\"){f=e}else{f=e.slice(1)}p=new glib.TextButton(f,n,0,l,a,n.height+16,function(){this.state=glib.Button.idle;this.parent.parent.dispatchEvent("chosen");if(Array.isArray(i)){d=i[this.index%i.length];if(d){d.call(s,this.index)}}else if(i){i.call(s,this.index)}},null,0);p.index=o++;p.lineColour="white";p.lineTransparency=255;p.onIdle=function(){this.panel.fillColour="black";this.panel.transparency=192};p.onHover=function(){this.panel.fillColour="slategrey";this.panel.transparency=255};p.onPressed=function(){this.panel.fillColour="darkslategrey";this.panel.transparency=255};p.panel.fillColour="black";p.panel.transparency=192;switch(t){case"<":p.label.setPivot(0,n.midPivot);p.label.setPosition(8,p.height/2);break;case">":p.label.setPivot(1,n.midPivot);p.label.setPosition(p.width-8,p.height/2);break}this.clip.addChild(p);l+=n.height+16;this.buttons.push(p)},this);this.addChild(new glib.OutlineRectangle(0,0,a,f,6,"white",3))}});glib.PopupMenu=glib.Class({inherit$:glib.Menu,$:function(e,t,n,r,i,s){glib.Menu.call(this,e,t,n,r,i,s);this.addEventHandler("chosen",this.close,this);this.addEventHandler("leftMouseUp",this.close,this);this.modal=true;this.setCapture(true)}})})();(function(){"use strict";glib.Window=glib.Class({inherit$:glib.Drawable,$:function(e){var t=e.closeButton===undefined?false:e.closeButton,n=e.draggable===undefined?true:e.draggable,r=e.cornerRadius||0,i=e.backgroundColour||"black",s=e.captionScale||1,o=e.captionColour!==undefined?e.captionColour:"darkslategrey",u=e.border===undefined?true:e.border,a=e.borderWidth||2,f=e.borderColor!==undefined?e.borderColor:"white",l=e.caption!==undefined,c=Math.max(l?e.font.height*s+a*4:0,r),h=e.width;glib.Drawable.call(this);this.size={width:e.width,height:e.height};this.setPosition(e.x,e.y);this.panel=new glib.Panel(0,0,e.width,e.height,i,undefined,r,0);this.addChild(this.panel);if(t){h-=c}this.clientOffset=c;this.clip=new glib.ClipRect(0,0,e.width,e.height,r);this.client=new glib.ClipRect(0,this.clientOffset,e.width,e.height-this.clientOffset);this.clip.addChild(this.client);this.addChild(this.clip);this.border=null;if(l){this.titleBar=new glib.Panel(0,0,h,c,o,undefined,0);this.titleBar.window=this;this.clip.addChild(this.titleBar);this.caption=(new glib.Label(e.caption,e.font)).setPosition(r+a+4,c/2).setScale(s).setPivot(0,e.font.midPivot);this.titleBar.addChild(this.caption);if(u){this.addChild(new glib.Line(0,c,e.width,c,f,a))}}if(t){this.closeButton=new glib.PanelButton(e.width-c,0,c,c,"darkred",undefined,0,0,function(){this.close()},this);this.closeButton.onHover=function(){this.fillColour="firebrick"};this.closeButton.onIdle=function(){this.fillColour="darkred"};this.closeButton.onPressed=function(){this.fillColour="red"};this.closeButton.addChild(new glib.Line(c*.25,c*.25,c*.75,c*.75,"white",c/8));this.closeButton.addChild(new glib.Line(c*.75,c*.25,c*.25,c*.75,"white",c/8));this.clip.addChild(this.closeButton);this.clip.addChild(new glib.Line(h,0,h,c,f,a))}if(f!==undefined){this.border=new glib.Panel(0,0,e.width,e.height,undefined,f,r,a);this.addChild(this.border)}this.client.window=this;this.drag=false;this.dragOffset={x:0,y:0};this.dragStart={x:0,y:0};if(l&&n){this.titleBar.addEventHandler("leftMouseDown",function(e){this.drag=true;this.titleBar.setCapture(true);this.dragStart=e.position;this.dragOffset={x:this.position.x-e.position.x,y:this.position.y-e.position.y}},this);this.titleBar.addEventHandler("leftMouseUp",function(e){this.titleBar.setCapture(false);this.drag=false},this);this.titleBar.addEventHandler("mouseMove",function(e){var t,n,r,i,s;if(this.drag){n=e.position.x+this.dragOffset.x;r=e.position.y+this.dragOffset.y;n=glib.Util.constrain(n,-this.width/4,glib.desktop.width+this.width/4);r=glib.Util.constrain(r,this.height/2,glib.desktop.height+this.height/2-this.clientOffset);this.setPosition(n,r)}},this)}if(e.backgroundTransparency!==undefined){this.panel.transparency=e.backgroundTransparency}if(e.modal!==undefined){this.modal=e.modal}},height:glib.Property({get:function(){return this.drawableData.dimensions.height},set:function(e){this.drawableData.dimensions.height=e;this.panel.height=e;this.clip.height=e;this.client.height=e-this.clientOffset;if(this.border){this.border.height=e}this.dispatchEvent("resize")}}),width:glib.Property({get:function(){return this.drawableData.dimensions.width},set:function(e){this.drawableData.dimensions.width=e;this.panel.width=e;this.clip.width=e;this.client.width=e;if(this.border){this.border.width=e}this.dispatchEvent("resize")}}),text:glib.Property({get:function(){return this.caption.text},set:function(e){this.caption.text=e}})})})();(function(){"use strict";var e=function(){if(this.window.callback){this.window.callback.call(this.window.context,this.index)}this.window.close()};glib.MessageWindow=glib.Class({inherit$:glib.Window,$:function(t,n,r,i,s,o){var u=glib.desktop.width/1.6666,a=glib.desktop.height/2,f=o===undefined?n:o,l=n.wrapText(t,u-20,"\r"),c=n.measureText(l),h=c.height+65+f.height,p,d,v,m,g,y;glib.Window.call(this,{x:glib.desktop.width/2,y:a,width:u,height:h,borderWidth:4,cornerRadius:8,backgroundTransparency:224,modal:true});this.setPivot(.5,.5);this.buttonHolder=new glib.Drawable;this.textBox=new glib.TextBox(20,10,this.width-50,c.height,t,n);this.client.addChild(this.textBox);d=0;for(p=0;p<r.length;++p){m=r[p];v=f.measureText(m).width+20;g=new glib.TextButton(m,f,d,0,v,f.height+8,e,null,4);g.index=p;g.window=this;this.buttonHolder.addChild(g);d+=v+20}this.buttonHolder.size={width:0,height:f.height+8};this.buttonHolder.setPosition(this.width-d,this.height-16);this.buttonHolder.setPivot(0,1);this.clip.addChild(this.buttonHolder);this.callback=i;this.context=s;this.addEventHandler("resize",function(){this.buttonHolder.setPosition(this.buttonHolder.x,this.height-16)},this)}});glib.MessageBox=glib.Class({inherit$:glib.Drawable,$:function(e,t,n,r,i,s){glib.Drawable.call(this);this.panel=new glib.Panel(0,0,glib.desktop.width,glib.desktop.height,"black");this.msgBox=new glib.MessageWindow(e,t,n,r,i,s);this.addChild(this.panel);this.addChild(this.msgBox);this.msgBox.addEventHandler("closing",function(){this.close()},this);this.age=0;this.msgBox.panel.transparency=0;this.panel.transparency=0},onUpdate:function(e,t){var n;this.age+=t;n=Math.min(1,this.age/125);n=glib.Util.ease(n);this.msgBox.panel.transparency=n*224;this.panel.transparency=n*96;this.msgBox.client.transparency=n*224},text:glib.Property({get:function(){return this.msgBox.text},set:function(e){this.msgBox.text=e}}),window:glib.Property({get:function(){return this.msgBox}})})})();(function(){"use strict";var e=[],t=[],n=[],r=[],i=[],s=[],o,u,a={none:0,backspace:8,tab:9,enter:13,shift:16,ctrl:17,space:32,pgup:33,pgdn:34,end:35,home:36,left:37,up:38,right:39,down:40,ins:45,del:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90},f={0:"none",8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",32:"space",33:"pgup",34:"pgdn",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"};glib.Keyboard={init:function(){var s=0;for(s=0;s<255;s+=1){e[s]=false;t[s]=false;n[s]=false;r[s]=false}addEventListener("keydown",function(e){i.push(new glib.KeyDownMessage(f[e.which],e.which))},false);addEventListener("keyup",function(e){i.push(new glib.KeyUpMessage(f[e.which],e.which))},false)},update:function(r){var u=0;while(s.length>0){if(s[0].action){t[s[0].key]=false}else{n[s[0].key]=false}s.shift()}while(i.length>0){switch(i[0].type){case glib.Message.keyDown:t[i[0].key]=true;e[i[0].key]=true;u=i[0].key;r.processMessage(i[0]);break;case glib.Message.keyUp:n[i[0].key]=true;e[i[0].key]=false;r.processMessage(i[0]);break}s.push(i.shift())}o=u!==0?f[u]:null},freeze:function(){u=true},unfreeze:function(){u=false},held:function(t){return u?false:e[a[t.toLowerCase()]]},pressed:function(e){return u?false:t[a[e.toLowerCase()]]},released:function(e){return u?false:n[a[e.toLowerCase()]]},lastKeyPressed:function(){return u?"":o}}})();(function(){"use strict";function e(e,t,n){var r=0,i=0,s=e;do{r+=s.offsetLeft-s.scrollLeft;i+=s.offsetTop-s.scrollTop;s=s.offsetParent}while(s!==null);return{x:t-r,y:n-i}}function t(e){var t;e=e||window.event;return{e:e,target:e.target||e.srcElement,which:e.which,x:e.x||e.clientX,y:e.y||e.clientY}}function n(){var e=window,t="innerWidth",n="innerHeight";if(!window.hasOwnProperty("innerWidth")){t="clientWidth";n="clientHeight";e=document.documentElement||document.body}return{width:e[t],height:e[n]}}function r(r,i,s,o){if(r.setCapture){r.setCapture()}r.addEventListener("losecapture",function(){if(r.setCapture){r.setCapture()}});r.addEventListener("touchstart",function(t){var n=t.targetTouches[0],r=e(i,n.clientX,n.clientY);o.push(new glib.TouchMessage(glib.Message.touchStart,r));t.preventDefault();return false});r.addEventListener("touchmove",function(t){var n=t.targetTouches[0],r=e(i,n.clientX,n.clientY);o.push(new glib.TouchMessage(glib.Message.touchMove,r));t.preventDefault();return false});r.addEventListener("touchend",function(e){o.push(new glib.TouchMessage(glib.Message.touchEnd,{x:0,y:0},true));e.preventDefault();return false});r.addEventListener("mousedown",function(n){var u;if(r.setCapture){r.setCapture()}n=t(n);u=e(i,n.x,n.y);switch(n.which){case 1:s.left.held=true;o.push(new glib.MouseMessage(glib.Message.leftMouseDown,u));break;case 3:s.right.held=true;o.push(new glib.MouseMessage(glib.Message.rightMouseDown,u));break}return false});r.addEventListener("mouseup",function(n){var r;n=t(n);r=e(i,n.x,n.y);switch(n.which){case 1:s.left.held=false;o.push(new glib.MouseMessage(glib.Message.leftMouseUp,r));break;case 3:s.right.held=false;o.push(new glib.MouseMessage(glib.Message.rightMouseUp,r));break}});r.addEventListener("mousemove",function(u){var a=n(),f,l;u=window.event||u;if(u&&u.preventDefault){u.preventDefault()}f=t(u);l=e(i,f.x,f.y);s.position.x=l.x;s.position.y=l.y;if(f.y<0||f.y>a.height||f.x<0||f.x>a.width){if(r.releaseCapture){r.releaseCapture()}}else{if(r.setCapture){r.setCapture()}}o.push(new glib.MouseMessage(glib.Message.mouseMove,l))})}function i(e){var t=e.held!==e.prev;e.pressed=t&&e.held;e.released=t&&!e.held;e.prev=e.held}var s=function(){this.position={x:-1,y:-1};this.delta={x:0,y:0};this.left={held:false,pressed:false,released:false,prev:false};this.right={held:false,pressed:false,released:false,prev:false}},o={x:0,y:0},u=new s,a=new s,f=a,l=[];glib.Mouse=glib.Class({static$:{init:function(e){r(document.body,e,a,l)},update:function(e){var t;i(a.left);i(a.right);a.delta.x=a.position.x-o.x;a.delta.y=a.position.y-o.y;o.x=a.position.x;o.y=a.position.y;while(l.length>0){e.processMessage(l.shift())}},freeze:function(){f=u},unfreeze:function(){f=a},position:glib.Property({get:function(){return f.position}}),delta:glib.Property({get:function(){return f.delta}}),left:glib.Property({get:function(){return f.left}}),right:glib.Property({get:function(){return f.right}})}})})();glib.Debug=function(){"use strict";var e,t,n=[],r,i;return{init:function(n,s){e=s;t=n;r=0;i=0},text:function(e,t,r){var i,s="",o="",u;for(i=2;i<arguments.length;++i){u=arguments[i];if(u===undefined){u="undefined"}else if(typeof u!=="string"){u=u.toString()}s=s+o+u;o=","}n.push("text",s,e,t)},print:function(){glib.Debug.text.apply(this,[r,i].concat(Array.prototype.slice.call(arguments,0)));i+=e.height},rect:function(e,t,r,i,s){n.push("rect",e,t,r,i,s)},fillRect:function(e,t,r,i,s){n.push("fillrect",e,t,r,i,s)},poly:function(e,t){var r;n.push("poly",e.length,t);for(r=0;r<e.length;++r){n.push(e[r].x,e[r].y)}},line:function(e,t,r,i,s){n.push("line",e,t,r,i,s)},draw:function(){var s,o,u;t.setTransform(1,0,0,1,0,0);while(n.length>0){switch(n.shift()){case"text":e.renderString(t,n.shift(),n.shift(),n.shift());break;case"rect":glib.Util.rect(t,n.shift(),n.shift(),n.shift(),n.shift());t.strokeStyle=n.shift();t.stroke();break;case"fillrect":glib.Util.rect(t,n.shift(),n.shift(),n.shift(),n.shift());t.fillStyle=n.shift();t.fill();break;case"line":t.beginPath();t.moveTo(n.shift(),n.shift());t.lineTo(n.shift(),n.shift());t.strokeStyle=n.shift();t.stroke();break;case"poly":t.beginPath();o=n.shift();u=n.shift();t.moveTo(n.shift(),n.shift());for(s=1;s<o;++s){t.lineTo(n.shift(),n.shift())}t.closePath();t.fillStyle=u;t.fill()}}r=0;i=0}}}();(function(){"use strict";var e,t,n,r,i,s=new glib.Matrix,o=function(){n.style.position="absolute";n.style.margin="0px";n.style.padding="0px";n.style.left="0px";n.style.top="0px";n.style.width=window.innerWidth+"px";n.style.height=window.innerHeight+"px";t.style.top=Math.floor((n.clientHeight-t.height)/2)+"px";t.style.left=Math.floor((n.clientWidth-t.width)/2)+"px"},u=function(){glib.Timer.update();glib.Keyboard.update(e);glib.Mouse.update(e);e.update(glib.Timer.time,glib.Timer.delta);e.draw(i,s,255);glib.Debug.draw();requestAnimationFrame(u)};glib.Playfield=glib.Class({inherit$:glib.Panel,$:function(s,a,f,l){if(e===undefined){e=this;glib.Panel.call(this,0,0,s,a,f);n=l!==undefined?l.DOMContainer||document.body:document.body;t=document.createElement("canvas");t.width=this.width;t.height=this.height;t.style.position="absolute";o();window.addEventListener("resize",o,false);n.appendChild(t);i=t.getContext("2d");this.canvas=t;r=new glib.Loader("img/");glib.Debug.init(i,glib.Font.load("Fixedsys",r));r.addEventHandler("complete",function(){glib.Mouse.init(t);glib.Keyboard.init();glib.Timer.init();u()},this);r.start()}}})})();