glib={none:undefined},function(){"use strict";function t(){var i=navigator.userAgent,n,t=i.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(t[1])?(n=/\brv[ :]+(\d+)/g.exec(i)||[],"MSIE "+(n[1]||"")):t[1]==="Chrome"&&(n=i.match(/\bOPR\/(\d+)/),n!==null)?"Opera "+n[1]:(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],n=i.match(/version\/(\d+)/i),n!==null&&t.splice(1,1,n[1]),t.join(" "))}var n=t().split(" ");glib.Browser={type:n[0],version:parseInt(n[1],10)}}(),function(){"use strict";function n(n,t,i){for(var f,u=Object.getOwnPropertyNames(t),r=0;r<u.length;++r)u[r].indexOf("$")!==-1||u[r]in n&&!i||(f=Object.getOwnPropertyDescriptor(t,u[r]),f.value instanceof glib.PropertyDescriptor?Object.defineProperty(n,u[r],f.value.desc):Object.defineProperty(n,u[r],f))}glib.PropertyDescriptor=function(n){this.desc=n};glib.Property=function(n){return new glib.PropertyDescriptor(n)};glib.Class=function(t){var i=t.$||{},r;if(t.static$!==undefined&&n(i,t.static$,!0),n(i.prototype,t,!0),t.hasOwnProperty("inherit$"))if(glib.Util.isArray(t.inherit$))for(r=0;r<t.inherit$.length;++r)if(t.inherit$[r])n(i,t.inherit$[r],!1),n(i.prototype,t.inherit$[r].prototype,!1);else throw new TypeError("Inheriting from undefined class!?");else n(i,t.inherit$,!1),n(i.prototype,t.inherit$.prototype,!1);return i}}(),function(){"use strict";var t,u,f,e,r,o=0,s=1,h=2,c=3,l=4,a=5,n=[],v=glib.Class({$:function(){},text:function(){},print:function(){},rect:function(){},fillRect:function(){},poly:function(){},line:function(){},draw:function(){}}),y=glib.Class({$:function(){},text:function(t,i){for(var f="",e="",r,u=2;u<arguments.length;++u)r=arguments[u],r===undefined?r="undefined":typeof r!="string"&&(r=r.toString()),f=f+e+r,e=",";n.push(s,f,t,i)},print:function(){glib.Debug.text.apply(this,[e,r].concat(Array.prototype.slice.call(arguments,0)));r+=u.height},rect:function(t,i,r,u,f){n.push(h,t,i,r,u,f)},fillRect:function(t,i,r,u,f){n.push(c,t,i,r,u,f)},poly:function(t,i){var r;for(n.push(l,t.length,i),r=0;r<t.length;++r)n.push(t[r].x,t[r].y)},line:function(t,i,r,u,f){n.push(a,t,i,r,u,f)},draw:function(){var i,f,o;for(t.setTransform(1,0,0,1,0,0);n.length>0;)switch(n.shift()){case s:u.renderString(t,n.shift(),n.shift(),n.shift());break;case h:glib.Util.rect(t,n.shift(),n.shift(),n.shift(),n.shift());t.strokeStyle=n.shift();t.stroke();break;case c:glib.Util.rect(t,n.shift(),n.shift(),n.shift(),n.shift());t.fillStyle=n.shift();t.fill();break;case a:t.beginPath();t.moveTo(n.shift(),n.shift());t.lineTo(n.shift(),n.shift());t.strokeStyle=n.shift();t.stroke();break;case l:for(t.beginPath(),f=n.shift(),o=n.shift(),t.moveTo(n.shift(),n.shift()),i=1;i<f;++i)t.lineTo(n.shift(),n.shift());t.closePath();t.fillStyle=o;t.fill()}e=0;r=0}}),i=new v;glib.Debug=glib.Class({static$:{init:function(n){t=n;f=new glib.Loader("img/");f.addEventHandler("complete",glib.Debug.fontLoaded);u=glib.Font.load("Fixedsys",f);f.start()},fontLoaded:function(){o=u.height;i=new y},text:function(){i.text.apply(null,Array.prototype.slice.call(arguments,0))},print:function(){i.text.apply(null,[e,r].concat(Array.prototype.slice.call(arguments,0)));r+=o},rect:function(n,t,r,u,f){i.rect(n,t,r,u,f)},fillRect:function(n,t,r,u,f){i.fillRect(n,t,r,u,f)},poly:function(n,t){i.poly(n,t)},line:function(n,t,r,u,f){i.line(n,t,r,u,f)},draw:function(){i.draw()}}})}();typeof performance=="undefined"&&(performance={}),function(){"use strict";(function(){for(var i=0,t=["moz","ms","o","webkit"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var t=(new Date).getTime(),r=Math.max(0,16-(t-i)),u=window.setTimeout(function(){n(t+r)},r);return i=t+r,u});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})})();performance=window.performance||{};Date.now||(Date.now=function(){return(new Date).getTime()});performance.now||(performance.now=performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||Date.now);window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),function(){function t(n,t){return this.slice(n,t)}function i(n,t){for(var u=t||0,i=0,r=n.length;i<r;++i,++t)this[u]=n[i]&255}function n(n){var r,u;if(typeof n=="number")for(r=[],r.length=n,u=0;u<n;++u)r[u]=0;else r=n.slice(0);return r.subarray=t,r.buffer=r,r.byteLength=r.length,r.set=i,typeof n=="object"&&n.buffer&&(r.buffer=n.buffer),r}try{var r=new Uint8Array(1);return}catch(u){}window.Uint8Array=n;window.Uint32Array=n;window.Int32Array=n}()}(),function(){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";glib.Util={shallowCopy:function(n,t){for(var i in n)t[i]=n[i]},clone:function(n){var t,i;if(n===null||typeof n!="object")return n;t=n.constructor();for(i in n)t[i]=glib.Util.clone(n[i]);return t},remove:function(n,t){var i=n.indexOf(t);i!==-1&&n.splice(i,1)},ease:function(n){var t=n*n,i=t*n;return 3*t-2*i},ease2:function(n,t){var i=1-n,r=Math.pow(i,t),u=Math.pow(i,t+1);return 1-(3*r-2*u)},lerp:function(n,t,i){var u=t.x-n.x,f=t.y-n.y,r=glib.Util.ease(i);return{x:n.x+u*r,y:n.y+f*r}},shuffle:function(n,t){for(var r,u,i=n.length;i>1;)r=t.ranged(i--),u=n[r],n[r]=n[i],n[i]=u},constrain:function(n,t,i){return n<t&&(n=t),n>i&&(n=i),n},lineIntersectsRectangle:function(n,t){var e,i=t[0].x,r=t[1].x,h=r-i,u,f,o,s;return(i>r&&(e=i,i=r,r=e),r>n.x+n.width&&(r=n.x+n.width),i<n.x&&(i=n.x),i>r)?!1:(u=t[0].y,f=t[1].y,Math.abs(h)>1e-7&&(o=(t[1].y-t[0].y)/h,s=t[0].y-o*t[0].x,u=o*i+s,f=o*r+s),u>f&&(e=f,f=u,u=e),f>n.y+n.height&&(f=n.y+n.height),u<n.y&&(u=n.y),f>u)},distance:function(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.sqrt(i*i+r*r)},lineDistance:function(n,t,i){var r=t.x-n.x,u=t.y-n.y,f=Math.sqrt(r*r+u*u);return(r*(i.y-n.y)-u*(i.x-n.x))/f},pointInConvexPoly:function(n,t){for(var r,u=n.length,i=0;i<u;++i)if(r=glib.Util.lineDistance(n[i],n[(i+1)%u],t),r<0)return!1;return!0},isArray:function(n){return Object.prototype.toString.call(n)==="[object Array]"},getResponseAsArray:function(n){function t(n){return n!==null?new Uint8Array(n):null}return n.response!==undefined?t(n.response):n.mozResponseArrayBuffer!==undefined?t(n.mozResponseArrayBuffer):n.mozResponse!==undefined?t(n.mozResponse):n.responseArrayBuffer!==undefined?t(n.responseArrayBuffer):n.responseBody!==null?t(new VBArray(n.responseBody).toArray()):null},createMask:function(){},circle:function(n,t,i,r){n.beginPath();n.arc(t,i,r,0,2*Math.PI,!1);n.closePath()},rect:function(n,t,i,r,u){var f=t+r,e=i+u;n.beginPath();n.moveTo(t,i);n.lineTo(f,i);n.lineTo(f,e);n.lineTo(t,e);n.closePath()},roundRect:function(n,t,i,r,u,f){var e=Math.min(f,Math.min(r/2,u/2)),o=t+r,s=i+u;e=e||0;n.beginPath();n.moveTo(t+e,i);n.lineTo(o-e,i);e&&n.quadraticCurveTo(o,i,o,i+e);n.lineTo(o,s-e);e&&n.quadraticCurveTo(o,s,o-e,s);n.lineTo(t+e,s);e&&n.quadraticCurveTo(t,s,t,s-e);n.lineTo(t,i+e);e&&n.quadraticCurveTo(t,i,t+e,i);n.closePath()},fancyRect:function(n,t,i,r,u,f){var e=f,o=t+r,s=i+u;n.beginPath();n.moveTo(t+e[0],i);n.lineTo(o-e[1],i);n.quadraticCurveTo(o,i,o,i+e[1]);n.lineTo(o,s-e[2]);n.quadraticCurveTo(o,s,o-e[2],s);n.lineTo(t+e[3],s);n.quadraticCurveTo(t,s,t,s-e[3]);n.lineTo(t,i+e[0]);n.quadraticCurveTo(t,i,t+e[0],i);n.closePath()},getQuery:function(){return glib.Util.queryStringToObject(window.location.search.slice(1))},queryStringToObject:function(n){var i={},r,u,t;if(n){r=n.split("&");for(u in r)t=r[u],t.indexOf("=")!==-1&&(t=t.split("="),t[0]?i[t[0].toLowerCase()]=decodeURIComponent(t[1]||""):i[t.toLowerCase()]=!0)}return i},objectToQueryString:function(n){var i=[];for(var t in n)n.hasOwnProperty(t)&&i.push(encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return i.join("&")},format:function(n){var t=Array.prototype.slice.call(arguments,1);return n.replace(/{(\d+)}/g,function(n,i){return typeof t[i]!="undefined"?t[i]:n})},log:function(n){var t=Array.prototype.slice.call(arguments,1);console.log(n.replace(/{(\d+)}/g,function(n,i){return typeof t[i]!="undefined"?t[i]:n}))},pad:function(n,t){var r=Math.abs(n),u=Math.max(0,t-Math.floor(r).toString().length),i=Math.pow(10,u).toString().substr(1);return n<0&&(i="-"+i),i+r},str_rep:function(n,t){for(var i="";;)if(t&1&&(i+=n),t>>=1,t)n+=n;else break;return i},getExtension:function(n){return n.match(/(?:(?:[\w\W]+)\.)([\w\W]+?)(\?|$)/)[1].toLowerCase()},btoa:function(t){for(var r="",o=t.length||t.byteLength,u,f,e,i=0;i<o-2;i+=3)u=t[i]&255,f=t[i+1]&255,e=t[i+2]&255,r+=n[u>>>2],r+=n[(u&3)<<4|f>>>4],r+=n[(f&15)<<2|e>>>6],r+=n[e&63];switch(o%3){case 2:r+=n[(t[i]&255)>>>2];r+=n[(t[i]&3)<<4|t[i+1]>>>4];r+=n[(t[i+1]&15)<<2];r+="=";break;case 1:r+=n[(t[i]&255)>>>2];r+=n[(t[i]&3)<<4];r+="=="}return r},atob:function(t){var r=[],o,s,h,c,f,u,e="",i=0;if(/[^A-Za-z0-9\+\/\=]/g.exec(t))return null;do c=n.indexOf(t.charAt(i++))>>>0,f=n.indexOf(t.charAt(i++))>>>0,u=n.indexOf(t.charAt(i++))>>>0,e=n.indexOf(t.charAt(i++))>>>0,o=c<<2|f>>>4,s=(f&15)<<4|u>>>2,h=(u&3)<<6|e,r.push(o),u!=64&&r.push(s),e!=64&&r.push(h);while(i<t.length);return r}}}(),function(){"use strict";glib.Message=glib.Class({static$:{leftMouseDown:1,leftMouseUp:2,rightMouseDown:3,rightMouseUp:4,mouseMove:5,touchStart:6,touchEnd:7,touchMove:8,keyDown:9,keyUp:10},$:function(n,t){this.type=n;this.global=t}});glib.MouseMessage=glib.Class({inherit$:glib.Message,$:function(n,t){glib.Message.call(this,n);this.position=t},x:glib.Property({get:function(){return this.position.x}}),y:glib.Property({get:function(){return this.position.y}})});glib.TouchMessage=glib.Class({inherit$:glib.Message,$:function(n,t,i){glib.Message.call(this,n,i);this.position=t},x:glib.Property({get:function(){return this.position.x}}),y:glib.Property({get:function(){return this.position.y}})});glib.KeyDownMessage=glib.Class({inherit$:glib.Message,$:function(n,t){glib.Message.call(this,glib.Message.keyDown,!0);this.name=n;this.key=t}});glib.KeyUpMessage=glib.Class({inherit$:glib.Message,$:function(n,t){glib.Message.call(this,glib.Message.keyUp,!0);this.name=n;this.key=t}});glib.EventHandler=glib.Class({$:function(n,t,i){this.target=n;this.context=t;this.oneOff=i}});glib.EventSource=glib.Class({$:function(){this.eventSourceData={handlers:{}}},addEventHandler:function(n,t,i,r){var u=this.eventSourceData,f=i||this;return u.handlers.hasOwnProperty(n)||(u.handlers[n]=[]),u.handlers[n].push(new glib.EventHandler(t,f,r)),this},clearEventHandlers:function(){return this.eventSourceData.handlers={},this},removeEventHandler:function(n,t){var u=this.eventSourceData,i,r=u.handlers[n];if(r)for(;;){if(i=r.indexOf(t),i===-1)break;r.splice(i,1)}return this},dispatchEvent:function(n){var u=this.eventSourceData,i=u.handlers[n],t,r;if(i)for(t=0;t<i.length;++t)if(r=i[t].target.apply(i[t].context,Array.prototype.slice.call(arguments,1)),i[t].oneOff&&i.splice(t,1),r===!0)break;return this}})}(),function(){"use strict";var i,t,r,u,n,f=65535;glib.Random=glib.Class({$:function(n){n=n||Date.now()>>>0;this.seed(n)},seed:function(f){i=123456789;t=362436069;r=521288629;u=88675123;n=f},next:function(){var f=(i^i>>>7)>>>0;return i=t,t=r,r=u,u=n,n=n^n<<6^(f^f<<13)>>>0,(t+t+1)*n>>>16},ranged:function(n){var i=f-(f+1)%n,t;do t=this.next();while(t>i);return t/((i+1)/n)>>>0},float:function(){return this.next()/(f+1)}})}();glib.Cookies=function(){"use strict";return{set:function(n,t,i){var r=new Date,u;r.setTime(r.getTime()+(i||1)*864e5);u="expires="+r.toGMTString();document.cookie=n+"="+t+"; "+u+";path=/"},get:function(n){for(var u=n+"=",i,r=document.cookie.split(";"),t=0;t<r.length;t++)if(i=r[t].trim(),i.indexOf(u)===0)return decodeURIComponent(i.substring(u.length,i.length));return null},remove:function(n){glib.Cookies.set(n,"X",-1)}}}(),function(){"use strict";function n(n,t,i,r,u,f,e,o){var h=o===undefined?!1:o,s;return console.log("AJAX "+u+":"+n),glib.Browser.type==="MSIE"&&glib.Browser.version<=10&&o?(s=new XDomainRequest,s.open(u,n),s.onerror=function(){console.log("XDomainRequest error loading "+n)},s.onprogress=function(){},s.timeout=5e3,s.ontimeout=function(){s.status=408;s.responseText="";console.log("XDomainRequest timeout loading "+n);t.call(r,n,s)},s.onload=function(){s.responseText&&(s.status=200);t.call(r,n,s)}):(s=new XMLHttpRequest,s.open(u,n),e&&(s.responseType="arraybuffer"),s.onreadystatechange=function(){s.readyState===XMLHttpRequest.DONE&&((s.responseType==="text"||s.responseType==="")&&s.responseText.length<1e3&&console.log("Data:"+s.responseText),t.call(r,n,s))},s.ontimeout=function(){console.log("Ajax timeout loading "+n);t.call(r,n,s)},s.onerror=function(){console.log("Ajax Error loading "+n)},s.onprogress=function(t){i&&i.call(r,n,t)},u==="POST"&&s.setRequestHeader("Content-type","application/x-www-form-urlencoded")),s.send(f),s}glib.ajax=glib.Class({static$:{url:function(n,t,i){var u=[],r,f="",e="?";for(r in t)u.push(encodeURIComponent(r)+"="+encodeURIComponent(t[r])),f="?",e="&";return n+f+u.join("&")+(i?e+(new Date).getTime()+"=1":"")},get:function(t,i,r,u,f,e){n(t,i,r,u,"GET",null,f,e)},post:function(t,i,r,u,f,e,o){var s=[];for(var h in i)s.push(encodeURIComponent(h)+"="+encodeURIComponent(i[h]));n(t,r,u,f,"POST",s.join("&"),e,o)}}})}(),function(){"use strict";function n(n,t,i,r){var u=null;if(t.status==200)try{u=JSON.parse(t.responseText)}catch(f){console.log("Bad result from web service: "+t.responseText)}i&&i.call(r,u)}glib.WebService=glib.Class({static$:{get:function(t,i,r,u){var f;i.action=t;f=glib.ajax.url(mtw.WebServiceURL,i,!0);glib.ajax.get(f,function(t,i){n(t,i,r,u)},null,this,!1,!0)},post:function(t,i,r,u,f){var e;i.action=t;e=glib.ajax.url(mtw.WebServiceURL,i,!0);glib.ajax.post(e,r,function(t,i){n(t,i,u,f)},null,this,!1,!0)}}})}();glib.List=function(){"use strict";function u(n,t){var i={item:null,next:n,prev:t};return n.prev=i,t.next=i,i}function r(n,f){var v,w,c,h,e,l,a,s,y,o,p;if(n>2){for(v=n>>>1,w=n-v,c=f.next,p=0;p<v;p+=1)c=c.next;for(h=u(f.next,c.prev),e=u(c,f.prev),r(v,h),r(w,e),s=e,o=h.next;o!==h;){do s=s.next;while(s!==e&&t.call(i,s.item,o.item)>0);if(s!==e){y=o;do o=o.next;while(o!==h&&t.call(i,o.item,s.item)>=0);y.prev=s.prev;s.prev.next=y;s.prev=o.prev;o.prev.next=s}else{o.prev=e.prev;e.prev.next=o;e.prev=h.prev;h.prev.next=e;break}}e.next.prev=f;e.prev.next=f;f.prev=e.prev;f.next=e.next}else n===2&&t.call(i,f.prev.item,f.next.item)>0&&(l=f.next,a=f.prev,f.next=a,f.prev=l,l.next=f,l.prev=a,a.next=l,a.prev=f)}var n=function(n){this.nodeName=n;this.root={item:null,next:null,prev:null};this.root.next=this.root;this.root.prev=this.root;this.size=0},t,i;return n.prototype={sort:function(n,u){t=n;i=u;r(this.size,this.root)},empty:function(){return this.size===0},clear:function(){this.root.next=this.root;this.root.prev=this.root;this.size=0},headNode:function(){return this.root.next},begin:function(){return this.root.next},end:function(){return this.root},tailNode:function(){return this.root.prev},head:function(){return this.root.next.item},tail:function(){return this.root.prev.item},next:function(n){return n[this.nodeName].next.item},prev:function(n){return n[this.nodeName].prev.item},insertBefore:function(n,t){var i=n[this.nodeName],r=t[this.nodeName];r.next=i;r.prev=i.prev;i.next.prev=r;i.prev=r;this.size+=1},insertAfter:function(n,t){var i=n[this.nodeName],r=t[this.nodeName];r.prev=i;r.next=i.next;i.prev.next=r;i.next=r;this.size+=1},pushFront:function(n){var t=n[this.nodeName];t.prev=this.root;t.next=this.root.next;this.root.next.prev=t;this.root.next=t;this.size+=1},pushBack:function(n){var t=n[this.nodeName];t.prev=this.root.prev;t.next=this.root;this.root.prev.next=t;this.root.prev=t;this.size+=1},add:function(n){this.pushBack(n)},popFront:function(){if(!this.empty()){var n=this.root.next;return n.prev.next=n.next,n.next.prev=n.prev,this.size-=1,n.item}return null},popBack:function(){if(!this.empty()){var n=this.root.prev;return n.prev.next=n.next,n.next.prev=n.prev,this.size-=1,n.item}return null},removeNode:function(n){n.prev.next=n.next;n.next.prev=n.prev;this.size-=1},remove:function(n){this.removeNode(n[this.nodeName])},moveToFront:function(n){var t=n[this.nodeName];t.prev.next=t.next;t.next.prev=t.prev;this.root.next.prev=t;this.root.next=t},moveToBack:function(n){var t=n[this.nodeName];t.prev.next=t.next;t.next.prev=t.prev;this.root.prev.next=t;this.root.prev=t},forEach:function(n,t){for(var i=this.root.next,r,u=0;i!==this.root;){if(r=i.next,n.call(t,i.item,u)===!1)return!1;i=r;u+=1}return!0},reverseForEach:function(n,t){for(var i=this.root.prev,r,u=0;i!==this.root;){if(r=i.prev,n.call(t,i.item,u)===!1)return!1;i=r;u+=1}return!0},removeIf:function(n,t){for(var i=this.root.next,r,u=0;i!==this.root;)r=i.next,n.call(t,i.item)===!0&&(i.prev.next=r,i.next.prev=i.prev,u+=1),i=r;return this.size-=u,u},findFirstOf:function(n,t){for(var i=this.root.next,r,u=0;i!==this.root;){if(r=i.next,n.call(t,i.item,u)===!0)return i.item;i=r;u+=1}return null},findLastOf:function(n,t){for(var i=this.root.next,r,u=0;i!==this.root;){if(r=i.prev,n.call(t,i.item,u)===!0)return i.item;i=r;u-=1}return null},select:function(t,i,r){for(var f=new n(t),u=this.root.next,e=0,o;u!==this.root;)o=u.next,i.call(r,u.item,e)===!0&&f.pushBack(u.item),u=o,e+=1;return f},reverseFind:function(n,t){for(var i=this.root.prev,r=0,u;i!==this.root;){if(u=i.prev,n.call(t,i.item,r)===!0)return i.item;i=u;r+=1}return null},toString:function(){var n="list ("+this.size.toString()+") <",t="";return this.forEach(function(i){n+=t+i.toString();t=","}),n+">"}},n.Node=function(n){return{item:n,next:null,prev:null}},n}(),function(){"use strict";var n=[];glib.Canvas=glib.Class({static$:{create:function(t,i){for(var f,u,s,h,e,o,r=n.length-1;r>=0;--r)if(f=n[r],e=f.width-t,o=f.height-i,e>=0&&o>=0){if(e+o===0){u=f;h=r;break}(s===undefined||e+o<s)&&(u=f,h=r,s=e+o)}return u?(n.splice(h,1),u.clear()):u=new glib.Canvas(t,i),u},showCache:function(){n.forEach(function(n){glib.Debug.print(n.width,n.height)})}},$:function(n,t){this.width=Math.ceil(n)>>>0;this.height=Math.ceil(t)>>>0;this.canvas=document.createElement("canvas");this.canvas.width=this.width;this.canvas.height=this.height;this.context=this.canvas.getContext("2d")},clear:function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)},destroy:function(){n.push(this)}})}(),function(){"use strict";function n(n,t){n[0]=t[0];n[1]=t[1];n[2]=t[2];n[3]=t[3];n[4]=t[4];n[5]=t[5]}glib.Matrix=glib.Class({$:function(){this.m=[1,0,0,1,0,0]},set:function(n,t,i,r,u,f){var e=this.m;return e[0]=n,e[1]=t,e[2]=i,e[3]=r,e[4]=u,e[5]=f,this},copyTo:function(t){n(t.m,this.m)},copyFrom:function(t){n(this.m,t.m)},setIdentity:function(){return this.set(1,0,0,1,0,0),this},multiplyInto:function(n,t){var i=this.m,r=n.m,u=t.m,f=i[0]*r[0]+i[2]*r[1],e=i[1]*r[0]+i[3]*r[1],o=i[0]*r[2]+i[2]*r[3],s=i[1]*r[2]+i[3]*r[3],h=i[0]*r[4]+i[2]*r[5]+i[4],c=i[1]*r[4]+i[3]*r[5]+i[5];return u[0]=f,u[1]=e,u[2]=o,u[3]=s,u[4]=h,u[5]=c,t},multiply:function(n){return this.multiplyInto(n,this)},translate:function(n){var t=this.m;return t[4]+=t[0]*n.x+t[2]*n.y,t[5]+=t[1]*n.x+t[3]*n.y,this},translation:glib.Property({get:function(){return{x:this.m[4],y:this.m[5]}},set:function(n){this.m[4]=n.x;this.m[5]=n.y}}),scale:function(n){var t=this.m;return t[0]*=n.x,t[1]*=n.x,t[2]*=n.y,t[3]*=n.y,this},rotate:function(n){var t=this.m,i=Math.cos(n),r=Math.sin(n),u=t[0]*i+t[2]*-r,f=t[1]*i+t[3]*-r,e=t[0]*r+t[2]*i,o=t[1]*r+t[3]*i;return t[0]=u,t[1]=f,t[2]=e,t[3]=o,this},invert:function(n){var t=this.m,i=t[0]*t[3]-t[1]*t[2];return i<1e-6?this.copyTo(n):(i=1/i,n.set(t[3]*i,t[1]*-i,t[2]*-i,t[0]*i,(t[2]*t[5]-t[3]*t[4])*i,(t[0]*t[5]-t[1]*t[4])*-i))},apply:function(n){var t=this.m;return{x:n.x*t[0]+n.y*t[2]+t[4],y:n.x*t[1]+n.y*t[3]+t[5]}},transform:function(n){for(var i=this.m,r,u,t=0;t<n.length;++t)r=n[t].x,u=n[t].y,n[t].x=r*i[0]+u*i[2]+i[4],n[t].y=r*i[1]+u*i[3]+i[5];return n},setContextTransform:function(n){var t=this.m;n.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])}})}(),function(){"use strict";glib.Drawable=glib.Class({inherit$:glib.EventSource,static$:{updateId:0,drawId:0},$:function(){glib.EventSource.call(this);this.drawableData={position:{x:0,y:0},dimensions:{width:0,height:0},padding:{left:0,top:0,right:0,bottom:0},rotation:0,scale:{x:1,y:1},drawScale:{x:1,y:1},dirty:!0,visible:!0,myZindex:0,baseZindex:0,reorder:!1,transparency:255,pivot:{x:0,y:0},mouseIsOver:!1,matrix:new glib.Matrix,pickMatrix:new glib.Matrix,globalMatrix:new glib.Matrix,mouseCapture:!1,touchCapture:!1,parent:null,enabled:!0,closed:!1,modal:!1,children:[]}},onKeyDown:function(){},onKeyUp:function(){},onMouseEnter:function(){return!1},onTouchEnter:function(){return!1},onTouchLeave:function(){return!1},onTouchStart:function(){return!1},onTouchEnd:function(){return!1},onTouchMove:function(){return!1},onMouseLeave:function(){return!1},onLeftMouseDown:function(){return!1},onLeftMouseUp:function(){return!1},onRightMouseDown:function(){return!1},onRightMouseUp:function(){return!1},onMouseMove:function(){return!1},onDraw:function(){return},onUpdate:function(){return},onClosed:function(){return},onLoaded:function(){return},processMessage:function(n,t,i){var r=this.drawableData,e,f,u=!1;if(this.enabled){for(t=t||r.mouseCapture,i=i||r.touchCapture,f=r.children.length-1;f>=0;--f)if(e=r.children[f],e.processMessage(n,t,i)||e.modal)return!0;if(this.visible&&this.enabled){n.position!==undefined&&(u=this.pick(n.position,0));switch(n.type){case glib.Message.touchStart:if(u||r.touchCapture){r.isTouched=!0;this.dispatchEvent("touchStart",n);return this.onTouchStart(n)}break;case glib.Message.touchEnd:return this.dispatchEvent("touchEnd"),r.isTouched=!1,this.onTouchEnd(n)&&!1;case glib.Message.leftMouseDown:if(u||r.mouseCapture){this.dispatchEvent("leftMouseDown",n);return this.onLeftMouseDown(n)}break;case glib.Message.rightMouseDown:if(u||r.mouseCapture){this.dispatchEvent("rightMouseDown",n);return this.onRightMouseDown(n)}break;case glib.Message.leftMouseUp:if(u||r.mouseCapture){this.dispatchEvent("leftMouseUp",n);return this.onLeftMouseUp(n)}break;case glib.Message.rightMouseUp:if(u||r.mouseCapture){this.dispatchEvent("rightMouseUp",n);return this.onRightMouseUp(n)}break;case glib.Message.mouseMove:if(u||r.mouseCapture){if(!r.mouseIsOver&&u){this.onMouseEnter(n);this.dispatchEvent("mouseEnter",n)}this.dispatchEvent("mouseMove",n);r.mouseIsOver=u;return this.onMouseMove(n)}if(r.mouseIsOver&&!u){this.dispatchEvent("mouseLeave",n);r.mouseIsOver=!1;return this.onMouseLeave(n)}break;case glib.Message.touchMove:if(u||r.touchCapture){!r.isTouched&&u&&this.dispatchEvent("touchEnter",n);r.isTouched=!0;this.dispatchEvent("touchMove",n);return this.onTouchMove(n)}if(r.isTouched&&!u){r.isTouched=!1;this.dispatchEvent("touchLeave",n);return this.onTouchLeave(n)}break;case glib.Message.keyDown:this.dispatchEvent("keyDown",n);this.onKeyDown(n);break;case glib.Message.keyUp:this.dispatchEvent("keyUp",n);this.onKeyUp(n)}}}return!1},loaded:function(n){var i=this.drawableData,r,t,u;this.dispatchEvent("loaded");this.onLoaded(n);for(t=0,u=i.children.length;t<u;++t)r=i.children[t],r.loaded(n)},update:function(n,t,i,r){for(var e=this.drawableData,f,o=!1,u=0;u<e.children.length;++u)f=e.children[u],f.drawableData.closed&&(f.dispatchEvent("closed"),f.onClosed(),f.drawableData.closed=!1,e.children.splice(u,1));if(e.enabled){for(u=e.children.length-1;u>=0;--u)f=e.children[u],f.update(n,t,i,r+4),f.drawableData.modal&&!o&&(glib.Mouse.freeze(),glib.Keyboard.freeze(),o=!0);if(e.enabled){this.onUpdate(n,t);glib.Drawable.updateId+=1}}o&&(glib.Mouse.unfreeze(),glib.Keyboard.unfreeze())},draw:function(n,t,i){var r=this.drawableData,u,f,e;if(r.visible){if(r.reorder){for(u=0,f=r.children.length;u<f;++u)r.children[u].drawableData.baseZindex=u;r.children.sort(function(n,t){var i=n.drawableData.myZindex-t.drawableData.myZindex;return i!==0?i:n.drawableData.baseZindex-t.drawableData.baseZindex});r.reorder=!1}if(t.multiplyInto(this.drawMatrix(),r.globalMatrix),r.globalMatrix.invert(r.pickMatrix),r.globalMatrix.setContextTransform(n),e=i*r.transparency/255,n.globalAlpha=e/255,n.save(),this.onDraw(n)!==!1)for(u=0,f=r.children.length;u<f;++u)r.children[u].draw(n,r.globalMatrix,e);n.restore()}},debug:function(){var n=this.drawableData,i,t,r;for(glib.Debug.text(n.matrix.m[4],n.matrix.m[5],n.dirty),t=0,r=n.children.length;t<r;++t)i=n.children[t],i.item.debug()},setPivot:function(n,t){return this.drawableData.pivot.x=n,this.drawableData.pivot.y=t,this.drawableData.dirty=!0,this},setRotation:function(n){return this.drawableData.rotation=n,this.drawableData.dirty=!0,this},setPosition:function(n,t){return this.drawableData.position.x=n,this.drawableData.position.y=t,this.drawableData.dirty=!0,this},setSize:function(n,t){return this.drawableData.dimensions.width=n,this.drawableData.dimensions.height=t,this.drawableData.dirty=!0,this},move:function(n,t){return this.drawableData.position.x+=n,this.drawableData.position.y+=t,this.drawableData.dirty=!0,this},setVisible:function(n){return this.drawableData.visible=n,this},setScale:function(n,t){return this.drawableData.scale.x=n,this.drawableData.scale.y=t!==undefined?t:n,this.drawableData.dirty=!0,this},setFlip:function(n,t){return this.drawableData.drawScale.x=n?-1:1,this.drawableData.drawScale.y=t?-1:1,this.drawableData.dirty=!0,this},refreshMatrix:function(){var n=this.drawableData,t,i;t={x:-n.pivot.x*this.width,y:-n.pivot.y*this.height};i={x:n.scale.x*n.drawScale.x,y:n.scale.y*n.drawScale.y};n.matrix.setIdentity().translate(n.position).rotate(n.rotation).scale(i).translate(t);n.dirty=!1},setCapture:function(n){return this.drawableData.mouseCapture=n,this.drawableData.touchCapture=n,this},screenToClient:function(n){var t=this.drawableData;return t.pickMatrix.apply(n)},clientToScreen:function(n){var t=this.drawableData;return t.globalMatrix.apply(n)},drawMatrix:function(){var n=this.drawableData;return n.dirty&&this.refreshMatrix(),n.matrix},pick:function(n){var t=this.screenToClient(n);return t.x>=0&&t.y>=0&&t.x<this.width&&t.y<this.height},removeChild:function(n){var t=this.drawableData.children.indexOf(n);t!==-1&&(n.drawableData.parent=null,this.drawableData.children.splice(t,1))},removeChildren:function(){for(var n=this.drawableData,t;n.children.length>0;)t=n.children.shift(),t.drawableData.parent=null},addChild:function(n){var t=this.drawableData;return n.drawableData.parent=this,t.children.push(n),t.reorder=!0,n},addChildToFront:function(n){var t=this.drawableData;return n.drawableData.parent=this,t.children.unshift(n),t.reorder=!0,n},addSibling:function(n){return this.drawableData.parent.addChild(n),this},close:function(){return this.dispatchEvent("closing"),this.drawableData.closed=!0,this},overlaps:function(){return!1},getScreenExtent:function(){var t,i,r,n=this.drawableData.extent,u=[{x:n.left,y:n.top},{x:n.right,y:n.top},{x:n.right,y:n.bottom},{x:n.left,y:n.bottom}];for(this.drawableData.globalMatrix.transform(u),i={x:u[0].x,y:point[0].y},r={x:u[0].x,y:point[0].y},t=1;t<4;++t)i.x=Math.min(i.x,u[t].x),i.y=Math.min(i.y,u[t].y),r.x=Math.max(r.x,u[t].x),r.y=Math.max(r.y,u[t].y);return{left:i.x,top:i.y,right:r.x,bottom:r.y}},rotation:glib.Property({get:function(){return this.drawableData.rotation},set:function(n){this.drawableData.rotation=n;this.drawableData.dirty=!0}}),position:glib.Property({get:function(){return this.drawableData.position},set:function(n){this.drawableData.position.x=n.x;this.drawableData.position.y=n.y;this.drawableData.dirty=!0}}),x:glib.Property({get:function(){return this.drawableData.position.x},set:function(n){this.drawableData.position.x=n;this.drawableData.dirty=!0}}),y:glib.Property({get:function(){return this.drawableData.position.y},set:function(n){this.drawableData.position.y=n;this.drawableData.dirty=!0}}),size:glib.Property({get:function(){return this.drawableData.dimensions},set:function(n){this.drawableData.dimensions.width=n.width;this.drawableData.dimensions.height=n.height;this.drawableData.dirty=!0}}),width:glib.Property({configurable:!0,get:function(){return this.drawableData.dimensions.width},set:function(n){this.drawableData.dimensions.width=n;this.drawableData.dirty=!0}}),height:glib.Property({configurable:!0,get:function(){return this.drawableData.dimensions.height},set:function(n){this.drawableData.dimensions.height=n;this.drawableData.dirty=!0}}),scale:glib.Property({get:function(){return this.drawableData.scale},set:function(n){this.drawableData.scale.x=n.x;this.drawableData.scale.y=n.y;this.drawableData.dirty=!0}}),zIndex:glib.Property({set:function(n){var t=this.drawableData;t.myZindex=n;t.parent!==null&&(t.parent.drawableData.reorder=!0)},get:function(){return this.drawableData.myZindex}}),parent:glib.Property({get:function(){return this.drawableData.parent}}),enabled:glib.Property({get:function(){return this.drawableData.enabled},set:function(n){this.drawableData.enabled=n}}),visible:glib.Property({set:function(n){this.drawableData.visible=n},get:function(){return this.drawableData.visible}}),transparency:glib.Property({set:function(n){this.drawableData.transparency=n},get:function(){return this.drawableData.transparency}}),modal:glib.Property({set:function(n){this.drawableData.modal=n},get:function(){return this.drawableData.modal}}),root:glib.Property({get:function(){for(var n=this.drawableData.parent;n!==null&&n.drawableData.parent!==null;)n=n.drawableData.parent;return n}}),setDirty:function(){this.drawableData.dirty=!0}})}(),function(){"use strict";var n,t;glib.Timer=glib.Class({inherit$:glib.Drawable,static$:{init:function(){n=performance.now()/1e3},update:function(){var i=performance.now()/1e3;t=i-n;n=i},time:glib.Property({get:function(){return n}}),delta:glib.Property({get:function(){return t}})},$:function(n,t,i,r){glib.Drawable.call(this);this.timeout=t;this.age=n;this.callback=i;this.context=r},onUpdate:function(n,t){this.age-=t;this.age<=0&&(this.timeout?this.age=this.timeout:this.parent&&this.close(),this.callback.call(this.context)===!1&&this.parent.removeChild(this))}})}(),function(){"use strict";glib.Composite=glib.Class({static$:{identityMatrix:new glib.Matrix},$:function(){this.compositeData={canvas:null,dirty:!1,oldOnDraw:this.onDraw,oldDraw:new glib.Matrix,oldPick:new glib.Matrix,oldGlobal:new glib.Matrix,oldTransparency:0};this.composable=!0},composite_compose:function(){var i,r,t=this.drawableData,n=this.compositeData;i=this.width+t.padding.left+t.padding.right+1;r=this.height+t.padding.top+t.padding.bottom+1;n.canvas===null||i>n.canvas.width||r>n.canvas.height?(n.canvas!==null&&n.canvas.destroy(),n.canvas=glib.Canvas.create(i,r)):n.canvas.clear();this.oldTransparency=t.transparency;this.drawMatrix().copyTo(n.oldDraw);t.pickMatrix.copyTo(n.oldPick);t.globalMatrix.copyTo(n.oldGlobal);t.matrix.setIdentity();this.transparency=255;this.onDraw=n.oldOnDraw;glib.Composite.identityMatrix.translation={x:t.padding.left,y:t.padding.top};this.draw(n.canvas.context,glib.Composite.identityMatrix,255);this.onDraw=this.composite_draw;t.transparency=this.oldTransparency;this.drawMatrix().copyFrom(n.oldDraw);t.pickMatrix.copyFrom(n.oldPick);t.globalMatrix.copyFrom(n.oldGlobal);n.dirty=!1},composite_draw:function(n){var t=this.compositeData,i=this.drawableData;return t.dirty&&this.composite_compose(),n.drawImage(t.canvas.canvas,-i.padding.left,-i.padding.top),!1},compose:function(){var n=this.compositeData;n.dirty=!0;this.composable&&(this.onDraw=this.composite_draw)},decompose:function(){this.onDraw=this.compositeData.oldOnDraw}})}(),function(){"use strict";var t=glib.Class({static$:{items:{},get:function(n){return t.items[n]!==undefined?t.items[n].object:undefined},put:function(n,i,r){t.items[n]={object:i,size:r}},dump:function(){var n;console.log("{");for(n in t.items)console.log('\t"'+n+'": '+t.items[n].size.toString()+",");console.log("}")}}}),i="R0lGODlhHAAeAKIAAMDAwICAgKyomfHv4v8AAAAAAP///wAAACH5BAAAAAAALAAAAAAcAB4AAAOAKLrc7kOYSau9NuLNp+5g9YXhSHbmuaVG4L4wfLEBCBSzZNXdnV88ji+jqwQ3Q1GREiQQJs5JkkKrOKNSHBFowWZ/O+uVMvUsJ82nAVs2VHtaJRcONtri1HPrXmcC/oCBf3hmFwWHiImJfSoYLI1ykCt6koWVjJduA5ucnZ6foAkAOw==",n=glib.Class({inherit$:glib.EventSource,$:function(t,i,r,u){var f;glib.EventSource.call(this);this.url=t;this.size=null;this.bytesReceived=0;this.data=i;this.loaded=!1;this.loader=r;this.inProgress=!1;this.binary=undefined;this.started=!1;f=u===undefined?glib.Util.getExtension(t):u;switch(f){case"jpg":case"jpeg":this.object=new Image;this.binary=!0;this.finalize=n.processJPEG;break;case"png":this.object=new Image;this.binary=!0;this.finalize=n.processImage;break;case"json":this.object={};this.binary=!1;this.finalize=n.processJSON;break;default:this.object=new Uint8Array;this.binary=!0;this.finalize=n.processBinary}},load:function(){var i;this.started||(this.started=!0,i=t.get(this.url),i!==undefined?(this.inProgress=!0,this.loaded=!0,this.object=i,this.doCallback()):glib.ajax.get(this.url,n.onLoaded,n.onProgress,this,this.binary))},doCallback:function(){this.dispatchEvent("loaded",this.object)},then:function(n,t){this.loaded?t.call(n,this.object):this.addEventHandler("loaded",t,n,!0)},static$:{onProgress:function(n,t){this.inProgress=!0;t.lengthComputable&&this.size===null&&(this.size=t.total);this.bytesReceived=t.loaded},onLoaded:function(i,r){var u=null,f=null,o=r.status,e=r.getResponseHeader("Content-Type");if(o==200)switch(e){case"image/png":u=glib.Util.getResponseAsArray(r);f=n.processImage;break;case"image/jpeg":u=glib.Util.getResponseAsArray(r);f=n.processJPEG;break;case"text/plain":case"application/json":u=r.responseText;f=n.processJSON;break;default:console.log("Unknown Content-Type: "+e);u=r.responseText;f=n.processText}f!==null&&u!==null&&(f.call(this,u),t.put(this.url,this.object,u.length));this.inProgress=!0;this.loaded=!0;this.doCallback()},processImage:function(n){this.object.src=n?"data:image/png;base64,"+glib.Util.btoa(n):"data:image/gif;base64,"+i},processJPEG:function(n){this.object.src=n?"data:image/jpeg;base64,"+glib.Util.btoa(n):"data:image/gif;base64,"+i},processJSON:function(n){var t;if(n)try{t=JSON.parse(n);glib.Util.shallowCopy(t,this.object)}catch(i){}},processText:function(){},processBinary:function(n){n&&this.object.set(n,0)}}});glib.Loader=glib.Class({inherit$:[glib.Drawable,glib.EventSource],static$:{dumpCacheManifest:function(){t.dump()}},$:function(n){glib.Drawable.call(this);glib.EventSource.call(this);this.baseDir=n||"";this.items={}},percentComplete:function(){var n,t=0,i=0;for(n in this.items)this.items[n].size!==undefined&&(t+=this.items[n].size),i+=this.items[n].bytesReceived;return t=t||i,i>0?i*100/t:0},complete:function(){for(var n in this.items)if(!this.items[n].loaded)return!1;return!0},onUpdate:function(){var i,t,n;glib.Debug.print("Loading, "+this.percentComplete().toFixed(0)+"% complete...");glib.Debug.print();for(i in this.items){for(t=this.items[i],n=t.bytesReceived.toString();n.length<20;)n=" "+n;glib.Debug.print(n+": "+t.url)}},reset:function(n){this.baseDir=n||this.baseDir;this.items={}},start:function(){for(var n in this.items)this.items[n].load()},itemLoaded:function(){this.complete()&&(this.parent!==null&&this.parent.loaded(this),this.dispatchEvent("complete"))},loadItem:function(t,i,r,u){var e=glib.ajax.url(this.baseDir+t,u),f=this.items[e];return f===undefined&&(f=new n(e,u,this),this.items[e]=f),f.load(),f},load:function(t,i,r,u,f){var o=glib.ajax.url(this.baseDir+t,u),e=this.items[o];return e===undefined&&(e=new n(o,u,this,f),this.items[o]=e),i&&e.addEventHandler("loaded",i,r),e.addEventHandler("loaded",this.itemLoaded,this),e.object}})}(),function(){"use strict";glib.Image=glib.Class({inherit$:glib.Drawable,$:function(n){var t=this;glib.Drawable.call(this);this.loaded=!1;this.image=new Image;this.image.onload=function(){t.size={width:t.image.width,height:t.image.height};t.loaded=!0;t.dispatchEvent("loaded");t.onDraw=t.realOnDraw};n&&(this.image.src=n)},scaleTo:function(n,t){return this.setScale(n/this.width,t/this.height),this},src:glib.Property({set:function(n){this.image.src=n}}),onDraw:function(){},realOnDraw:function(n){var t=this.width,i=this.height;n.drawImage(this.image,0,0,t,i,0,0,t,i)}})}(),function(){"use strict";glib.Sprite=glib.Class({inherit$:glib.Drawable,$:function(n){glib.Drawable.call(this);this.image=n;this.UV={x:0,y:0};this.framesWide=1;this.framesHigh=1;this.frameWidth=null;this.frameHeight=null;this.currentFrame=0;this.frame=0},static$:{load:function(n,t){return new glib.Sprite(t.load(n+".png"))}},setFrameXY:function(n,t){this.UV.x=n*this.frameWidth;this.UV.y=t*this.frameHeight},setFrame:function(n){this.currentFrame=n;this.setFrameXY(n%this.framesWide>>>0,n/this.framesWide>>>0)},frame:glib.Property({get:function(){return this.currentFrame},set:function(n){this.setFrame(n)}}),width:glib.Property({get:function(){return this.frameWidth||this.image.width}}),height:glib.Property({get:function(){return this.frameHeight||this.image.height}}),size:glib.Property({get:function(){return{width:this.width,height:this.height}}}),scaleTo:function(n,t){return this.setScale(n/this.width,t/this.height),this},onDraw:function(n){var t=this.width,i=this.height;n.drawImage(this.image,this.UV.x,this.UV.y,t,i,0,0,t,i)}})}(),function(){"use strict";glib.Button=glib.Class({inherit$:glib.EventSource,static$:{idle:0,hover:1,pressed:2},$:function(n,t){this.currentState=glib.Button.idle;this.callback=n;this.context=t||this},onHover:function(){},onIdle:function(){},onPressed:function(){},onClicked:function(){},onTouchStart:function(){return this.state=glib.Button.pressed,!0},onTouchEnd:function(){return this.state===glib.Button.pressed&&(this.state=glib.Button.idle,this.dispatchEvent("clicked",this),this.callback&&this.callback.call(this.context||this)),!0},onTouchEnter:function(){return!0},onTouchLeave:function(){return this.state=glib.Button.idle,!0},onMouseEnter:function(){return this.state=glib.Button.hover,!0},onMouseLeave:function(){return this.state=glib.Button.idle,!0},onLeftMouseDown:function(){return this.state=glib.Button.pressed,!0},onLeftMouseUp:function(){return this.state===glib.Button.pressed&&(this.state=glib.Button.hover,this.onClicked(),this.dispatchEvent("clicked"),this.callback&&this.callback.call(this.context||this)),!0},state:glib.Property({get:function(){return this.currentState},set:function(n){if(this.currentState!=n){this.currentState=n;switch(n){case glib.Button.idle:this.dispatchEvent("idle");this.onIdle();break;case glib.Button.hover:this.dispatchEvent("hover");this.onHover();break;case glib.Button.pressed:this.dispatchEvent("pressed");this.onPressed()}}}})})}(),function(){"use strict";glib.Rectangle=glib.Class({inherit$:glib.Drawable,$:function(n,t,i,r,u){glib.Drawable.call(this);this.setPosition(n,t);this.size={width:i,height:r};this.radius=u===undefined?0:u;this.fancy=glib.Util.isArray(this.radius)},onDraw:function(n){this.fancy?glib.Util.fancyRect(n,0,0,this.width,this.height,this.radius):this.radius>0?glib.Util.roundRect(n,0,0,this.width,this.height,this.radius):glib.Util.rect(n,0,0,this.width,this.height)}});glib.ClipRect=glib.Class({inherit$:glib.Rectangle,$:function(n,t,i,r,u){glib.Rectangle.call(this,n,t,i,r,u)},onDraw:function(n){glib.Rectangle.prototype.onDraw.call(this,n);n.clip()}});glib.SolidRectangle=glib.Class({inherit$:glib.Rectangle,$:function(n,t,i,r,u,f){glib.Rectangle.call(this,n,t,i,r,u);this.fillColour=f},drawIt:function(n){n.fillStyle=this.fillColour;n.fill()},onDraw:function(n){glib.Rectangle.prototype.onDraw.call(this,n);this.drawIt(n)}});glib.OutlineRectangle=glib.Class({inherit$:glib.Rectangle,$:function(n,t,i,r,u,f,e){glib.Rectangle.call(this,n,t,i,r,u);this.lineColour=f;this.lineWidth=e===undefined?1:e},drawIt:function(n){n.lineWidth=this.lineWidth;n.strokeStyle=this.lineColour;n.stroke()},onDraw:function(n){glib.Rectangle.prototype.onDraw.call(this,n);this.drawIt(n)}});glib.Panel=glib.Class({inherit$:glib.Rectangle,$:function(n,t,i,r,u,f,e,o){glib.Rectangle.call(this,n,t,i,r,e);this.fillColour=u;this.lineColour=f;this.lineWidth=o||1},onDraw:function(n){glib.Rectangle.prototype.onDraw.call(this,n);this.fillColour!==undefined&&glib.SolidRectangle.prototype.drawIt.call(this,n);this.lineColour!==undefined&&glib.OutlineRectangle.prototype.drawIt.call(this,n)}});glib.Line=glib.Class({inherit$:glib.Drawable,$:function(n,t,i,r,u,f){glib.Drawable.call(this);this.x1=n;this.x2=i;this.y1=t;this.y2=r;this.colour=u;this.lineWidth=f},onDraw:function(n){n.beginPath();n.moveTo(this.x1,this.y1);n.lineTo(this.x2,this.y2);n.strokeStyle=this.colour;n.lineWidth=this.lineWidth;n.stroke()}});glib.PanelButton=glib.Class({inherit$:[glib.Button,glib.Composite,glib.Panel],$:function(n,t,i,r,u,f,e,o,s,h){glib.Button.call(this,s,h);glib.Composite.call(this);glib.Panel.call(this,n,t,i,r,u,f,e,o)}});glib.LinkButton=glib.Class({inherit$:[glib.Button,glib.Line],$:function(n,t,i,r,u,f,e){var s=Math.floor(n)+.5,l=Math.floor(i)+.5,h=Math.floor(t)+.5,a=Math.floor(r)+.5,o=a-h,c=l-s;glib.Line.call(this,0,o,c,o,"skyblue",1);glib.Button.call(this,function(){this.linkClicked&&this.linkClicked.call(this.clickContext,this.link)},this);this.clickContext=e;this.link=u;this.linkClicked=f;this.setPosition(s,h);this.size={width:c,height:o}},onIdle:function(){this.colour="skyblue"},onHover:function(){this.colour="red"},onPressed:function(){this.colour="white"}})}(),function(){"use strict";var n=function(){var n=this.labelData,t=this.drawableData.padding;n.extent=this.labelData.font.measureText(this.labelData.text);this.size={width:n.extent.width,height:n.extent.height};t.left=-n.extent.left;t.top=-n.extent.top;t.right=n.extent.right-n.extent.width;t.bottom=n.extent.bottom-n.extent.height},t;glib.Label=glib.Class({inherit$:[glib.Composite,glib.Drawable],$:function(t,i){glib.Drawable.call(this);glib.Composite.call(this);this.labelData={text:t,font:i,extent:null};n.call(this);this.compose()},text:glib.Property({configurable:!0,get:function(){return this.labelData.text},set:function(t){this.labelData.text!==t&&(this.labelData.text=t,n.call(this),this.compose())}}),font:glib.Property({get:function(){return this.labelData.font},set:function(t){this.labelData.font!==t&&(this.labelData.font=t,n.call(this),this.compose())}}),onDraw:function(n){var t=this.labelData;t.font.renderString(n,t.text,.5,.5)}});t=function(n){this.linkClicked!==undefined&&this.linkClicked.call(this.context,n)};glib.TextBox=glib.Class({inherit$:glib.ClipRect,$:function(n,t,i,r,u,f,e,o,s){glib.ClipRect.call(this,n,t,i,r,0);this.label=new glib.Label(u,f);o&&(this.links=new glib.Drawable,this.addChild(this.links),this.links.zIndex=10);this.addChild(this.label);this.context=s;this.setPosition(n,t);this.linkClicked=o;this.lineBreak=e||"\r";this.text=u},text:glib.Property({set:function(n){var i=[],r;if(this.label.text=this.label.font.wrapText(n,this.width,this.lineBreak),this.linkClicked)for(this.label.font.measureText(this.label.text,i),this.links.removeChildren();i.length>0;)r=new glib.LinkButton(i.shift(),i.shift(),i.shift(),i.shift(),i.shift(),t,this),this.links.addChild(r)},get:function(){return this.label.text}})})}(),function(){"use strict";glib.Font=glib.Class({static$:{load:function(n,t){return new glib.Font(t.load(n+".json"),t.load(n+"0.png"))}},$:function(n,t){this.page=t;this.font=n;this.lineSpacing=0;this.softLineSpacing=0;this.letterSpacing=0;this.mask=255},midPivot:glib.Property({get:function(){return this.font.baseline/this.font.height/2}}),baselinePivot:glib.Property({get:function(){return this.font.baseline/this.font.height}}),height:glib.Property({get:function(){return this.font.height}}),baseline:glib.Property({get:function(){return this.font.baseline}}),renderString:function(n,t,i,r){for(var c,s,h,l,e,u,a,v=!1,y=!1,o=!1,p=this.lineSpacing,w=this.softLineSpacing,f=0;f<this.font.layerCount;++f)if(1<<f&this.mask)for(s=this.font.Layers[f],h=i+s.offsetX,l=r+s.offsetY,c=0;c<t.length;++c){if(e=t[c],!y)switch(e){case"\n":h=s.offsetX;l+=this.font.height+p;o=!0;break;case"\r":h=s.offsetX;l+=this.font.height+w;o=!0;break;case"\\":y=!0;o=!0;break;case"@":v=!v;o=!0;break;default:o=!1}o||(e=this.font.charMap[e.charCodeAt(0)],e!==undefined&&(a=this.font.glyphs[e],f<a.imageCount&&(u=a.images[f],n.drawImage(this.page,u.x,u.y,u.w,u.h,h+u.offsetX,l+u.offsetY,u.w,u.h)),h+=a.advance))}},measureText:function(n,t,i){var g=i===undefined?this.font.layerCount-1:i,u,s,v=0,r,f,c,e,l,o,a=!1,d=!1,h=!1,y="",p=0,w=0,b=0,k=0,nt=this.softLineSpacing,tt=this.lineSpacing;for(t&&(t.length=0),u=0;u<this.font.layerCount;++u)for(s=this.font.Layers[u],r=s.offsetX,f=s.offsetY,c=0;c<n.length;++c){if(e=n[c],!d)switch(e){case"\n":r=s.offsetX;f+=this.font.height+tt;h=!0;break;case"\r":r=s.offsetX;f+=this.font.height+nt;h=!0;break;case"\\":d=!0;h=!0;break;case"@":a=!a;h=!0;t&&u===0&&(a?t.push(r-s.offsetX,f):(t.push(r,f+this.font.baseline+3,y),y=""));break;default:h=!1}h||(a&&(y+=e),e=this.font.charMap[e.charCodeAt(0)],e!==undefined&&(l=this.font.glyphs[e],u<l.imageCount&&(o=l.images[u],p=Math.min(o.offsetX+r,p),w=Math.max(o.offsetX+o.w+r,w),b=Math.min(o.offsetY+f,b),k=Math.max(o.offsetY+o.h+f,k)),r+=l.advance,u===g&&(v=Math.max(r,v))))}return{width:v,height:f+this.font.height,left:p,right:w,top:b,bottom:k}},wrapText:function(n,t,i){for(var r=1,u,f,e;this.measureText(n).width>=t;){for(f=-1,u=r;u<n.length;++u)if(n[u]===" "){if(e=n.slice(0,u),this.measureText(e).width>=t)break;f=u}if(f===-1)break;if(r=f,r>=n.length)break;n=n.slice(0,r)+i+n.slice(r+1);r+=i.length}return n}})}(),function(){"use strict";glib.TextButton=glib.Class({inherit$:[glib.Button,glib.Drawable],$:function(n,t,i,r,u,f,e,o,s,h){var c=h===undefined?!0:!1;glib.Button.call(this,e,o);glib.Drawable.call(this);this.idleFillColour="darkSlateGrey";this.hoverFillColour="slateGrey";this.pressedFillColour="lightSlateGrey";c?(this.idleLineColour="white",this.hoverLineColour="white",this.pressedLineColour="darkSlateGrey"):(this.idleLineColour=undefined,this.hoverLineColour=undefined,this.pressedLineColour=undefined);this.label=new glib.Label(n,t);this.size={width:Math.max(u,this.label.width+16),height:f};this.setPosition(i,r);this.panel=new glib.Panel(0,0,this.width,f,"darkSlateGrey",this.idleLineColour,s===undefined?f/3:s,3);this.addChild(this.panel);this.label.setPivot(.5,t.midPivot);this.label.setPosition(this.width/2,this.height/2);this.addChild(this.label)},text:glib.Property({set:function(n){this.label.text=n},get:function(){return this.label.text}}),onHover:function(){this.panel.lineColour=this.hoverLineColour;this.panel.fillColour=this.hoverFillColour},onIdle:function(){this.panel.lineColour=this.idleLineColour;this.panel.fillColour=this.idleFillColour},onPressed:function(){this.panel.lineColour=this.pressedLineColour;this.panel.fillColour=this.pressedFillColour}})}(),function(){"use strict";glib.SpriteButton=glib.Class({inherit$:[glib.Button,glib.Sprite],$:function(n,t,i,r,u,f){glib.Button.call(this,u,f);glib.Sprite.call(this,n);this.setPivot(.5,.5);this.type=t;this.setPosition(i,r);this.origin={x:i,y:r}},onIdle:function(){switch(this.type){case"frame":this.setFrame(0);break;case"offset":this.setPosition(this.origin.x,this.origin.y);break;case"scale":this.setScale(1)}},onHover:function(){switch(this.type){case"frame":this.setFrame(1);break;case"offset":this.setPosition(this.origin.x-1,this.origin.y-1);break;case"scale":this.setScale(1.25)}},onPressed:function(){switch(this.type){case"frame":this.setFrame(2);break;case"offset":this.setPosition(this.origin.x+2,this.origin.y+2);break;case"scale":this.setScale(1.5)}}})}(),function(){"use strict";glib.Menu=glib.Class({inherit$:glib.Drawable,$:function(n,t,i,r,u,f){for(var v=i.height,o=0,h,l=0,a,e,c,s=0;s<r.length;++s)a=r[s],o=Math.max(o,i.measureText(a).width+8);o+=32;h=(i.height+16)*r.length;glib.Drawable.call(this);this.setPosition(n,t);this.size={width:o,height:h};this.clip=new glib.ClipRect(0,0,o,h,6);this.addChild(this.clip);this.transparency=224;this.font=i;this.setPosition(n,t);this.buttons=[];s=0;r.forEach(function(n){var t=n[0],r;r=t!=="<"&&t!==">"&&t!=="\\"?n:n.slice(1);e=new glib.TextButton(r,i,0,l,o,i.height+16,function(){this.state=glib.Button.idle;this.parent.parent.dispatchEvent("chosen");Array.isArray(u)?(c=u[this.index%u.length],c&&c.call(f,this.index)):u&&u.call(f,this.index)},null,0);e.index=s++;e.lineColour="white";e.lineTransparency=255;e.onIdle=function(){this.panel.fillColour="black";this.panel.transparency=192};e.onHover=function(){this.panel.fillColour="slategrey";this.panel.transparency=255};e.onPressed=function(){this.panel.fillColour="darkslategrey";this.panel.transparency=255};e.panel.fillColour="black";e.panel.transparency=192;switch(t){case"<":e.label.setPivot(0,i.midPivot);e.label.setPosition(8,e.height/2);break;case">":e.label.setPivot(1,i.midPivot);e.label.setPosition(e.width-8,e.height/2)}this.clip.addChild(e);l+=i.height+16;this.buttons.push(e)},this);this.addChild(new glib.OutlineRectangle(0,0,o,h,6,"white",3))}});glib.PopupMenu=glib.Class({inherit$:glib.Menu,$:function(n,t,i,r,u,f){glib.Menu.call(this,n,t,i,r,u,f);this.addEventHandler("chosen",this.close,this);this.addEventHandler("leftMouseUp",this.close,this);this.modal=!0;this.setCapture(!0)}})}(),function(){"use strict";glib.Window=glib.Class({inherit$:glib.Drawable,$:function(n){var o=n.closeButton===undefined?!1:n.closeButton,h=n.draggable===undefined?!0:n.draggable,i=n.cornerRadius||0,c=n.backgroundColour||"black",s=n.captionScale||1,l=n.captionColour!==undefined?n.captionColour:"darkslategrey",a=n.border===undefined?!0:n.border,r=n.borderWidth||2,u=n.borderColor!==undefined?n.borderColor:"white",e=n.caption!==undefined,t=Math.max(e?n.font.height*s+r*4:0,i),f=n.width;glib.Drawable.call(this);this.size={width:n.width,height:n.height};this.setPosition(n.x,n.y);this.panel=new glib.Panel(0,0,n.width,n.height,c,undefined,i,0);this.addChild(this.panel);o&&(f-=t);this.clientOffset=t;this.clip=new glib.ClipRect(0,0,n.width,n.height,i);this.client=new glib.ClipRect(0,this.clientOffset,n.width,n.height-this.clientOffset);this.clip.addChild(this.client);this.addChild(this.clip);this.border=null;e&&(this.titleBar=new glib.Panel(0,0,f,t,l,undefined,0),this.titleBar.window=this,this.clip.addChild(this.titleBar),this.caption=new glib.Label(n.caption,n.font).setPosition(i+r+4,t/2).setScale(s).setPivot(0,n.font.midPivot),this.titleBar.addChild(this.caption),a&&this.addChild(new glib.Line(0,t,n.width,t,u,r)));o&&(this.closeButton=new glib.PanelButton(n.width-t,0,t,t,"darkred",undefined,0,0,function(){this.close()},this),this.closeButton.onHover=function(){this.fillColour="firebrick"},this.closeButton.onIdle=function(){this.fillColour="darkred"},this.closeButton.onPressed=function(){this.fillColour="red"},this.closeButton.addChild(new glib.Line(t*.25,t*.25,t*.75,t*.75,"white",t/8)),this.closeButton.addChild(new glib.Line(t*.75,t*.25,t*.25,t*.75,"white",t/8)),this.clip.addChild(this.closeButton),this.clip.addChild(new glib.Line(f,0,f,t,u,r)));u!==undefined&&(this.border=new glib.Panel(0,0,n.width,n.height,undefined,u,i,r),this.addChild(this.border));this.client.window=this;this.drag=!1;this.dragOffset={x:0,y:0};this.dragStart={x:0,y:0};e&&h&&(this.titleBar.addEventHandler("leftMouseDown",function(n){this.drag=!0;this.titleBar.setCapture(!0);this.dragStart=n.position;this.dragOffset={x:this.position.x-n.position.x,y:this.position.y-n.position.y}},this),this.titleBar.addEventHandler("leftMouseUp",function(){this.titleBar.setCapture(!1);this.drag=!1},this),this.titleBar.addEventHandler("mouseMove",function(n){var t,i,r,u;this.drag&&(r=glib.Playfield.Width,u=glib.Playfield.Height,t=n.position.x+this.dragOffset.x,i=n.position.y+this.dragOffset.y,t=glib.Util.constrain(t,-this.width/4,r+this.width/4),i=glib.Util.constrain(i,this.height/2,u+this.height/2-this.clientOffset),this.setPosition(t,i))},this));n.backgroundTransparency!==undefined&&(this.panel.transparency=n.backgroundTransparency);n.modal!==undefined&&(this.modal=n.modal)},height:glib.Property({get:function(){return this.drawableData.dimensions.height},set:function(n){this.drawableData.dimensions.height=n;this.panel.height=n;this.clip.height=n;this.client.height=n-this.clientOffset;this.border&&(this.border.height=n);this.dispatchEvent("resize")}}),width:glib.Property({get:function(){return this.drawableData.dimensions.width},set:function(n){this.drawableData.dimensions.width=n;this.panel.width=n;this.clip.width=n;this.client.width=n;this.border&&(this.border.width=n);this.dispatchEvent("resize")}}),text:glib.Property({get:function(){return this.caption.text},set:function(n){this.caption.text=n}})})}(),function(){"use strict";var n=function(){this.window.callback&&this.window.callback.call(this.window.context,this.index);this.window.close()};glib.MessageWindow=glib.Class({inherit$:glib.Window,$:function(t,i,r,u,f,e){var v=glib.Playfield.Width/1.6666,p=glib.Playfield.Height/2,o=e===undefined?i:e,w=i.wrapText(t,v-20,"\r"),y=i.measureText(w),b=y.height+65+o.height,s,h,l,a,c;for(glib.Window.call(this,{x:glib.Playfield.Width/2,y:p,width:v,height:b,borderWidth:4,cornerRadius:8,backgroundTransparency:224}),this.setPivot(.5,.5),this.buttonHolder=new glib.Drawable,this.textBox=new glib.TextBox(20,10,this.width-50,y.height,t,i),this.client.addChild(this.textBox),h=0,s=0;s<r.length;++s)a=r[s],l=o.measureText(a).width+20,c=new glib.TextButton(a,o,h,0,l,o.height+8,n,null,4),c.index=s,c.window=this,this.buttonHolder.addChild(c),h+=l+20;this.buttonHolder.size={width:0,height:o.height+8};this.buttonHolder.setPosition(this.width-h,this.height-16);this.buttonHolder.setPivot(0,1);this.clip.addChild(this.buttonHolder);this.callback=u;this.context=f;this.addEventHandler("resize",function(){this.buttonHolder.setPosition(this.buttonHolder.x,this.height-16)},this)}});glib.MessageBox=glib.Class({inherit$:glib.Drawable,$:function(n,t,i,r,u,f){glib.Drawable.call(this);this.panel=new glib.Panel(0,0,glib.Playfield.Width,glib.Playfield.Height,"black");this.msgBox=new glib.MessageWindow(n,t,i,r,u,f);this.addChild(this.panel);this.panel.modal=!0;this.panel.addEventHandler("leftMouseDown",function(){this.close()},this);this.addChild(this.msgBox);this.msgBox.addEventHandler("closing",function(){this.close()},this);this.age=0;this.msgBox.panel.transparency=0;this.panel.transparency=0},onUpdate:function(n,t){var i;this.age+=t;i=Math.min(1,this.age*6);i=glib.Util.ease(i);this.msgBox.panel.transparency=i*224;this.panel.transparency=i*96;this.msgBox.client.transparency=i*224},text:glib.Property({get:function(){return this.msgBox.text},set:function(n){this.msgBox.text=n}}),window:glib.Property({get:function(){return this.msgBox}})})}(),function(){"use strict";var r=[],u=[],f=[],h=[],n=[],t=[],s,i,e={none:0,backspace:8,tab:9,enter:13,shift:16,ctrl:17,space:32,pgup:33,pgdn:34,end:35,home:36,left:37,up:38,right:39,down:40,ins:45,del:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90},o={0:"none",8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",32:"space",33:"pgup",34:"pgdn",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"};glib.Keyboard={init:function(){for(var t=0,t=0;t<255;t+=1)r[t]=!1,u[t]=!1,f[t]=!1,h[t]=!1;addEventListener("keydown",function(t){n.push(new glib.KeyDownMessage(o[t.which],t.which))},!1);addEventListener("keyup",function(t){n.push(new glib.KeyUpMessage(o[t.which],t.which))},!1)},update:function(i){for(var e=0;t.length>0;)t[0].action?u[t[0].key]=!1:f[t[0].key]=!1,t.shift();while(n.length>0){switch(n[0].type){case glib.Message.keyDown:u[n[0].key]=!0;r[n[0].key]=!0;e=n[0].key;i.processMessage(n[0]);break;case glib.Message.keyUp:f[n[0].key]=!0;r[n[0].key]=!1;i.processMessage(n[0])}t.push(n.shift())}s=e!==0?o[e]:null},freeze:function(){i=!0},unfreeze:function(){i=!1},held:function(n){return i?!1:r[e[n.toLowerCase()]]},pressed:function(n){return i?!1:u[e[n.toLowerCase()]]},released:function(n){return i?!1:f[e[n.toLowerCase()]]},lastKeyPressed:function(){return i?"":s}}}(),function(){"use strict";function i(n,t,i){var u=0,f=0,r=n;do u+=r.offsetLeft-r.scrollLeft,f+=r.offsetTop-r.scrollTop,r=r.offsetParent;while(r!==null);return{x:t-u,y:i-f}}function u(n){return n=n||window.event,{e:n,target:n.target||n.srcElement,which:n.which,x:n.x||n.clientX,y:n.y||n.clientY}}function s(){var n=window,t="innerWidth",i="innerHeight";return window.hasOwnProperty("innerWidth")||(t="clientWidth",i="clientHeight",n=document.documentElement||document.body),{width:n[t],height:n[i]}}function h(n,t,r,f){n.setCapture&&n.setCapture();n.addEventListener("losecapture",function(){n.setCapture&&n.setCapture()});n.addEventListener("touchstart",function(n){var r=n.targetTouches[0],u=i(t,r.clientX,r.clientY);return f.push(new glib.TouchMessage(glib.Message.touchStart,u)),n.preventDefault(),!1});n.addEventListener("touchmove",function(n){var r=n.targetTouches[0],u=i(t,r.clientX,r.clientY);return f.push(new glib.TouchMessage(glib.Message.touchMove,u)),n.preventDefault(),!1});n.addEventListener("touchend",function(n){return f.push(new glib.TouchMessage(glib.Message.touchEnd,{x:0,y:0},!0)),n.preventDefault(),!1});n.addEventListener("mousedown",function(e){var o;n.setCapture&&n.setCapture();e=u(e);o=i(t,e.x,e.y);switch(e.which){case 1:r.left.held=!0;f.push(new glib.MouseMessage(glib.Message.leftMouseDown,o));break;case 3:r.right.held=!0;f.push(new glib.MouseMessage(glib.Message.rightMouseDown,o))}return!1});n.addEventListener("mouseup",function(n){var e;n=u(n);e=i(t,n.x,n.y);switch(n.which){case 1:r.left.held=!1;f.push(new glib.MouseMessage(glib.Message.leftMouseUp,e));break;case 3:r.right.held=!1;f.push(new glib.MouseMessage(glib.Message.rightMouseUp,e))}});n.addEventListener("mousemove",function(e){var c=s(),o,h;e=window.event||e;e&&e.preventDefault&&e.preventDefault();o=u(e);h=i(t,o.x,o.y);r.position.x=h.x;r.position.y=h.y;o.y<0||o.y>c.height||o.x<0||o.x>c.width?n.releaseCapture&&n.releaseCapture():n.setCapture&&n.setCapture();f.push(new glib.MouseMessage(glib.Message.mouseMove,h))})}function e(n){var t=n.held!==n.prev;n.pressed=t&&n.held;n.released=t&&!n.held;n.prev=n.held}var o=function(){this.position={x:-1,y:-1};this.delta={x:0,y:0};this.left={held:!1,pressed:!1,released:!1,prev:!1};this.right={held:!1,pressed:!1,released:!1,prev:!1}},r={x:0,y:0},c=new o,n=new o,t=n,f=[];glib.Mouse=glib.Class({static$:{init:function(t){h(document.body,t,n,f)},update:function(t){for(e(n.left),e(n.right),n.delta.x=n.position.x-r.x,n.delta.y=n.position.y-r.y,r.x=n.position.x,r.y=n.position.y;f.length>0;)t.processMessage(f.shift())},freeze:function(){t=c},unfreeze:function(){t=n},position:glib.Property({get:function(){return t.position}}),delta:glib.Property({get:function(){return t.delta}}),left:glib.Property({get:function(){return t.left}}),right:glib.Property({get:function(){return t.right}})}})}(),function(){"use strict";var t,n,i,o=0,r,u,s=new glib.Matrix,f=function(){n.style.top=Math.floor((i.clientHeight-n.height)/2)+"px";n.style.left=Math.floor((i.clientWidth-n.width)/2)+"px"},e=function(){glib.Timer.update();glib.Keyboard.update(t);glib.Mouse.update(t);glib.Drawable.updateId=0;t.update(glib.Timer.time,glib.Timer.delta,o++,0);glib.Drawable.drawId=0;t.draw(r,s,255);glib.Debug.draw();requestAnimationFrame(e)};glib.Playfield=glib.Class({inherit$:glib.Panel,$:function(o){var s=o||{},h=s.width||640,c=s.height||480,l=s.backgroundColour||"black";i=s.DOMContainer||document.body;u=s.autoCenter||!1;t=this;glib.Panel.call(this,0,0,h,c,l);n=document.createElement("canvas");n.width=this.width;n.height=this.height;u&&(n.style.position="absolute",f(),window.addEventListener("resize",f,!1));i.appendChild(n);r=n.getContext("2d");s.NoDebug||glib.Debug.init(r);glib.Mouse.init(n);glib.Keyboard.init();glib.Timer.init();e()},static$:{Width:glib.Property({get:function(){return t.width}}),Height:glib.Property({get:function(){return t.height}}),Size:glib.Property({get:function(){return{width:t.width,height:t.height}}}),Root:glib.Property({get:function(){return t}})}})}()